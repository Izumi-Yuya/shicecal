name: Test SSH Connection

on:
  workflow_dispatch:

jobs:
  test-ssh:
    name: Test SSH Connection
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Debug SSH Key
      run: |
        echo "ğŸ” SSHéµã®å½¢å¼ã‚’ç¢ºèªä¸­..."
        
        # SSHéµã®å­˜åœ¨ç¢ºèª
        if [ -z "${{ secrets.AWS_TEST_PRIVATE_KEY }}" ]; then
          echo "âŒ AWS_TEST_PRIVATE_KEY ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“"
          exit 1
        fi
        
        # SSHéµã®é•·ã•ç¢ºèª
        key_length=$(echo "${{ secrets.AWS_TEST_PRIVATE_KEY }}" | wc -c)
        echo "SSHéµã®æ–‡å­—æ•°: $key_length"
        
        # SSHéµã®é–‹å§‹è¡Œç¢ºèª
        echo "${{ secrets.AWS_TEST_PRIVATE_KEY }}" | head -1
        
        # SSHéµã®çµ‚äº†è¡Œç¢ºèª
        echo "${{ secrets.AWS_TEST_PRIVATE_KEY }}" | tail -1
        
    - name: Test SSH Connection
      uses: appleboy/ssh-action@v0.1.5
      with:
        host: ${{ secrets.AWS_TEST_HOST }}
        username: ${{ secrets.AWS_TEST_USERNAME }}
        key: ${{ secrets.AWS_TEST_PRIVATE_KEY }}
        script: |
          echo "ğŸ‰ SSHæ¥ç¶šæˆåŠŸï¼"
          whoami
          pwd
          uname -a