# 防災・防犯タブ ドキュメント管理機能 実装チェックリスト

## 実装完了項目

### ✅ ビューファイルの更新
- [x] 防犯カメラ・電子錠タブにドキュメント管理ボタンを追加
- [x] 消防・防災タブにドキュメント管理ボタンを追加
- [x] 防犯カメラ・電子錠用ドキュメント管理モーダルを追加
- [x] 消防・防災用ドキュメント管理モーダルを追加
- [x] lifeline-document-managerコンポーネントの統合

### ✅ バックエンドサポート
- [x] LifelineDocumentServiceに`security_disaster`カテゴリが含まれている
- [x] LifelineEquipmentモデルのCATEGORIESに`security_disaster`が含まれている
- [x] ルート設定が既に存在（`lifeline-documents/{category}`）
- [x] LifelineDocumentControllerが`security_disaster`カテゴリをサポート

### ✅ コンポーネント
- [x] lifeline-document-managerコンポーネントが利用可能
- [x] LifelineDocumentManager.jsが実装済み
- [x] ApiClient.jsが実装済み

### ✅ セキュリティ
- [x] LifelineEquipmentPolicyによる認可チェック
- [x] ファイルバリデーション（タイプ、サイズ）
- [x] ActivityLogServiceによるログ記録

## 動作確認項目

### 基本機能
- [ ] 防犯カメラ・電子錠タブでドキュメントボタンが表示される
- [ ] 消防・防災タブでドキュメントボタンが表示される
- [ ] ドキュメントボタンをクリックするとモーダルが開く
- [ ] モーダルが正しく表示される（ヘッダー、ボディ、フッター）

### フォルダ操作
- [ ] 「新しいフォルダ」ボタンが表示される（編集権限がある場合）
- [ ] フォルダ作成モーダルが開く
- [ ] フォルダ名を入力して作成できる
- [ ] 作成したフォルダが一覧に表示される
- [ ] フォルダをクリックして中に入れる
- [ ] ブレッドクラムでナビゲーションできる
- [ ] フォルダ名を変更できる
- [ ] フォルダを削除できる

### ファイル操作
- [ ] 「ファイルアップロード」ボタンが表示される（編集権限がある場合）
- [ ] ファイルアップロードモーダルが開く
- [ ] ファイルを選択してアップロードできる
- [ ] アップロードしたファイルが一覧に表示される
- [ ] ファイル名をクリックしてダウンロードできる
- [ ] ファイル名を変更できる
- [ ] ファイルを別のフォルダに移動できる
- [ ] ファイルを削除できる

### 表示機能
- [ ] リスト表示とグリッド表示を切り替えられる
- [ ] ファイルサイズが正しく表示される
- [ ] 更新日時が正しく表示される
- [ ] ファイルアイコンが適切に表示される

### 検索・フィルター
- [ ] 検索ボックスでファイル名を検索できる
- [ ] ファイルタイプでフィルタリングできる
- [ ] ソート順を変更できる（名前、日付、サイズ）

### 権限管理
- [ ] 閲覧権限のみのユーザーは編集ボタンが表示されない
- [ ] 編集権限のあるユーザーは全機能が使用できる
- [ ] 権限のない施設のドキュメントにアクセスできない

### エラーハンドリング
- [ ] ファイルサイズ超過時にエラーメッセージが表示される
- [ ] 不正なファイルタイプ時にエラーメッセージが表示される
- [ ] ネットワークエラー時に適切なメッセージが表示される
- [ ] 重複するフォルダ名を作成しようとするとエラーが表示される

### レスポンシブデザイン
- [ ] モバイル画面でも正しく表示される
- [ ] タブレット画面でも正しく表示される
- [ ] デスクトップ画面で最適に表示される

### アクセシビリティ
- [ ] キーボードでモーダルを操作できる
- [ ] ESCキーでモーダルを閉じられる
- [ ] フォーカス管理が適切
- [ ] スクリーンリーダーで操作できる

## テスト手順

### 1. 基本動作テスト

#### 防犯カメラ・電子錠タブ
1. 施設詳細画面を開く
2. 「防犯・防災」タブをクリック
3. 「防犯カメラ・電子錠」サブタブが選択されていることを確認
4. 「ドキュメント」ボタンをクリック
5. モーダルが開くことを確認
6. モーダルのタイトルが「防犯カメラ・電子錠ドキュメント管理」であることを確認

#### 消防・防災タブ
1. 「消防・防災」サブタブをクリック
2. 「ドキュメント」ボタンをクリック
3. モーダルが開くことを確認
4. モーダルのタイトルが「消防・防災ドキュメント管理」であることを確認

### 2. フォルダ作成テスト
1. ドキュメント管理モーダルを開く
2. 「新しいフォルダ」ボタンをクリック
3. フォルダ名に「点検報告書」と入力
4. 「作成」ボタンをクリック
5. フォルダが一覧に表示されることを確認
6. 成功メッセージが表示されることを確認

### 3. ファイルアップロードテスト
1. ドキュメント管理モーダルを開く
2. 「ファイルアップロード」ボタンをクリック
3. PDFファイルを選択
4. 「アップロード」ボタンをクリック
5. ファイルが一覧に表示されることを確認
6. 成功メッセージが表示されることを確認

### 4. ファイルダウンロードテスト
1. アップロードしたファイルの名前をクリック
2. ファイルがダウンロードされることを確認
3. ダウンロードしたファイルが正しく開けることを確認

### 5. フォルダナビゲーションテスト
1. 作成したフォルダをクリック
2. フォルダ内に移動することを確認
3. ブレッドクラムに現在の位置が表示されることを確認
4. ブレッドクラムの「防犯・防災設備」をクリック
5. ルートフォルダに戻ることを確認

### 6. ファイル編集テスト
1. ファイルの「...」メニューをクリック
2. 「名前を変更」を選択
3. 新しい名前を入力
4. 「保存」ボタンをクリック
5. ファイル名が変更されることを確認

### 7. ファイル移動テスト
1. ファイルの「...」メニューをクリック
2. 「移動」を選択
3. 移動先フォルダを選択
4. 「移動」ボタンをクリック
5. ファイルが移動先フォルダに表示されることを確認

### 8. 削除テスト
1. ファイルの「...」メニューをクリック
2. 「削除」を選択
3. 確認ダイアログで「削除」をクリック
4. ファイルが一覧から消えることを確認
5. 成功メッセージが表示されることを確認

### 9. 権限テスト
1. 閲覧権限のみのユーザーでログイン
2. ドキュメント管理モーダルを開く
3. 「新しいフォルダ」ボタンが表示されないことを確認
4. 「ファイルアップロード」ボタンが表示されないことを確認
5. ファイルの「...」メニューが表示されないことを確認

### 10. エラーハンドリングテスト
1. 10MBを超えるファイルをアップロード
2. エラーメッセージが表示されることを確認
3. PDF以外のファイルをアップロード（設定による）
4. 適切なエラーメッセージが表示されることを確認

## ブラウザ互換性テスト

- [ ] Chrome（最新版）
- [ ] Firefox（最新版）
- [ ] Safari（最新版）
- [ ] Edge（最新版）
- [ ] モバイルSafari（iOS）
- [ ] Chrome（Android）

## パフォーマンステスト

- [ ] 100個のファイルがある場合でもスムーズに動作する
- [ ] 大きなファイル（10MB）のアップロードが正常に完了する
- [ ] 複数のファイルを同時にアップロードできる
- [ ] ページ読み込み時間が許容範囲内

## セキュリティテスト

- [ ] 未認証ユーザーはアクセスできない
- [ ] 権限のない施設のドキュメントにアクセスできない
- [ ] XSS攻撃に対して安全
- [ ] CSRF保護が機能している
- [ ] ファイルパストラバーサル攻撃に対して安全

## 既知の制限事項

1. **subcategoryパラメータ**
   - 現在、subcategoryパラメータは渡されていますが、完全には活用されていません
   - 防犯カメラ・電子錠と消防・防災は同じルートフォルダを共有します
   - ユーザーはフォルダで手動で分類する必要があります

2. **ファイルプレビュー**
   - 現在、ファイルプレビュー機能は実装されていません
   - ファイルをダウンロードして確認する必要があります

3. **バージョン管理**
   - ファイルのバージョン管理機能は実装されていません
   - 同じ名前のファイルをアップロードすると上書きされます

## 次のステップ

### 優先度：高
- [ ] 実際の環境でテストを実施
- [ ] ユーザーフィードバックを収集
- [ ] バグ修正

### 優先度：中
- [ ] subcategoryパラメータの完全な実装
- [ ] ファイルプレビュー機能の追加
- [ ] 一括ダウンロード機能の追加

### 優先度：低
- [ ] バージョン管理機能の追加
- [ ] ファイル共有機能の追加
- [ ] ファイルタグ機能の追加

## 完了基準

以下の条件がすべて満たされた場合、実装完了とみなします：

1. すべての基本機能が正常に動作する
2. 権限管理が正しく機能する
3. エラーハンドリングが適切に実装されている
4. 主要ブラウザで動作する
5. セキュリティテストに合格する
6. ユーザーが問題なく使用できる
7. ドキュメントが整備されている

## 備考

- この実装は既存のライフライン設備ドキュメント管理機能をベースにしています
- 最小限の変更で実装できるように設計されています
- 将来的な拡張を考慮した設計になっています
