# 契約書ドキュメント遅延ロード - 検証チェックリスト

## 実装完了確認

### コード変更
- ✅ `ContractDocumentManager.js`に`isInitialLoad`プロパティ追加
- ✅ `init()`メソッドから`loadDocuments()`呼び出しを削除
- ✅ `setupLazyLoading()`メソッドを新規追加
- ✅ `shown.bs.collapse`イベントリスナーを実装
- ✅ フォールバック処理を実装

### ビルド確認
- ✅ `npm run build`が成功
- ✅ JavaScriptに構文エラーなし
- ✅ アセットが正常に生成

### ドキュメント作成
- ✅ `contract-document-lazy-loading.md`作成
- ✅ `contract-document-consolidation-task5-summary.md`作成
- ✅ 検証チェックリスト作成

## 機能検証（手動テスト）

### 1. 初期表示の確認

**手順:**
1. ブラウザの開発者ツールを開く
2. Networkタブを開く
3. 施設詳細ページの契約書タブを表示

**期待結果:**
- [ ] `/facilities/{id}/contract-documents`へのAPIリクエストが**発生しない**
- [ ] 統一ドキュメントセクションが折りたたまれた状態で表示
- [ ] 「ドキュメントを表示」ボタンが表示される
- [ ] コンソールに`[ContractDoc] Lazy loading enabled`が表示

### 2. 初回展開の確認

**手順:**
1. 「ドキュメントを表示」ボタンをクリック
2. Networkタブでリクエストを確認
3. コンソールログを確認

**期待結果:**
- [ ] セクションが展開される
- [ ] ローディングインジケーターが表示される
- [ ] `/facilities/{id}/contract-documents`へのAPIリクエストが**1回だけ**発生
- [ ] ドキュメント一覧が表示される
- [ ] コンソールに`[ContractDoc] First expand detected - loading documents`が表示

### 3. 2回目以降の展開確認

**手順:**
1. 「ドキュメントを非表示」ボタンをクリックしてセクションを折りたたむ
2. 再度「ドキュメントを表示」ボタンをクリック
3. Networkタブでリクエストを確認

**期待結果:**
- [ ] セクションが展開される
- [ ] APIリクエストが**発生しない**
- [ ] ドキュメント一覧が即座に表示される
- [ ] コンソールに`[ContractDoc] Section expanded - documents already loaded`が表示

### 4. ドキュメント操作の確認

**手順:**
1. フォルダ作成ボタンをクリック
2. フォルダを作成
3. ファイルアップロードボタンをクリック
4. ファイルをアップロード

**期待結果:**
- [ ] フォルダ作成モーダルが正常に表示される
- [ ] フォルダが正常に作成される
- [ ] ファイルアップロードモーダルが正常に表示される
- [ ] ファイルが正常にアップロードされる
- [ ] 操作後にドキュメント一覧が更新される

### 5. エラーハンドリングの確認

**手順:**
1. ネットワークをオフラインにする
2. 「ドキュメントを表示」ボタンをクリック

**期待結果:**
- [ ] エラーメッセージが表示される
- [ ] コンソールにエラーログが出力される
- [ ] アプリケーションがクラッシュしない

## パフォーマンス検証

### 初期ロード時間の測定

**手順:**
1. ブラウザの開発者ツールのPerformanceタブを開く
2. ページをリロード
3. 契約書タブを表示
4. ロード時間を記録

**期待結果:**
- [ ] 契約書タブの初期表示が2秒以内
- [ ] APIリクエストが発生しない分、高速化を確認

### ネットワークトラフィックの確認

**手順:**
1. Networkタブでリクエスト数を確認
2. 初期表示時とドキュメント展開時を比較

**期待結果:**
- [ ] 初期表示時: `/facilities/{id}/contract-documents`リクエストなし
- [ ] 初回展開時: リクエスト1回のみ
- [ ] 2回目以降: リクエストなし

## ブラウザ互換性確認

### 対応ブラウザ
- [ ] Chrome（最新版）
- [ ] Firefox（最新版）
- [ ] Safari（最新版）
- [ ] Edge（最新版）

### 確認項目
- [ ] 遅延ロードが正常に動作
- [ ] Bootstrap Collapseイベントが正常に発火
- [ ] コンソールログが正常に出力

## レスポンシブデザイン確認

### デバイスサイズ
- [ ] デスクトップ（1920x1080）
- [ ] タブレット（768x1024）
- [ ] モバイル（375x667）

### 確認項目
- [ ] 折りたたみボタンが正常に表示
- [ ] セクションの展開/折りたたみが正常に動作
- [ ] ドキュメント一覧が適切に表示

## アクセシビリティ確認

### キーボード操作
- [ ] Tabキーで折りたたみボタンにフォーカス可能
- [ ] Enterキーでセクションを展開/折りたたみ可能
- [ ] フォーカスインジケーターが表示される

### スクリーンリーダー
- [ ] 折りたたみボタンのaria-expanded属性が正しく更新される
- [ ] セクションのaria-labelledby属性が設定されている
- [ ] 状態変化が適切に通知される

## セキュリティ確認

### 認証・認可
- [ ] 未認証ユーザーはドキュメントにアクセスできない
- [ ] 権限のないユーザーは編集操作ができない
- [ ] APIエンドポイントが適切に保護されている

### XSS対策
- [ ] ファイル名が適切にエスケープされている
- [ ] フォルダ名が適切にエスケープされている
- [ ] ユーザー入力が適切にサニタイズされている

## 後方互換性確認

### フォールバック処理
- [ ] 統一ドキュメントセクションが存在しない場合、即座にロード
- [ ] 古いバージョンのビューファイルでも動作
- [ ] エラーが発生しない

## デバッグ情報確認

### コンソールログ
```
期待されるログ出力:
[ContractDoc] Initializing manager for facility: {id}
[ContractDoc] Lazy loading enabled - documents will load on first expand
[ContractDoc] First expand detected - loading documents
[ContractDoc] Section expanded - documents already loaded
```

### エラーログ
```
エラー時のログ出力:
[ContractDoc] Unified section not found, loading documents immediately
[ContractDoc] Load documents error: {error message}
```

## 完了基準

すべてのチェック項目が✅になったら、タスク5.4は完了とみなします。

### 必須項目
- ✅ コード変更完了
- ✅ ビルド成功
- ✅ ドキュメント作成完了
- [ ] 初期表示の確認（手動テスト）
- [ ] 初回展開の確認（手動テスト）
- [ ] 2回目以降の展開確認（手動テスト）
- [ ] ドキュメント操作の確認（手動テスト）

### 推奨項目
- [ ] パフォーマンス検証
- [ ] ブラウザ互換性確認
- [ ] レスポンシブデザイン確認
- [ ] アクセシビリティ確認
- [ ] セキュリティ確認

## 備考

- 手動テストは実際のブラウザで実施してください
- パフォーマンス測定は複数回実施して平均値を取ることを推奨
- 問題が発見された場合は、このチェックリストに記録してください
