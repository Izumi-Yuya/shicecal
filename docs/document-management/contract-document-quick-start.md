# 契約書ドキュメント管理 - クイックスタートガイド

## 概要

契約書のドキュメント管理は、モーダルベースの統一されたシステムとして実装されています。ライフライン設備やメンテナンス履歴と同じ使い勝手で、直感的な操作が可能です。

## 主な機能

### 📁 フォルダ管理
- フォルダの作成・削除・名前変更
- 階層構造のサポート
- パンくずナビゲーション

### 📄 ファイル管理
- ファイルのアップロード・ダウンロード・削除
- ファイル名の変更
- 最大50MBまでのファイルサポート

### 🔍 検索機能
- ファイル名・フォルダ名での検索
- リアルタイム検索結果表示

### 👁️ 表示モード
- **リスト表示**: テーブル形式で詳細情報を表示
- **グリッド表示**: カード形式で視覚的に表示

### ⚡ パフォーマンス
- **遅延ロード**: 初回展開時にドキュメントを読み込み
- **エラーハンドリング**: ネットワークエラー時の自動再試行

## 使い方

### 1. ドキュメントセクションを開く

契約書タブで「ドキュメントを表示」ボタンをクリックします。

```
┌─────────────────────────────────────────┐
│ 📁 契約書関連ドキュメント  [ドキュメントを表示] │
└─────────────────────────────────────────┘
```

初回展開時に自動的にドキュメントが読み込まれます。

### 2. フォルダを作成

「新しいフォルダ」ボタンをクリックして、モーダルでフォルダ名を入力します。

```
┌─────────────────────────────────┐
│ 新しいフォルダ - 契約書          │
├─────────────────────────────────┤
│ フォルダ名: [____________]      │
│                                 │
│ [キャンセル]  [作成]            │
└─────────────────────────────────┘
```

### 3. ファイルをアップロード

「ファイルアップロード」ボタンをクリックして、ファイルを選択します。

```
┌─────────────────────────────────┐
│ ファイルアップロード - 契約書    │
├─────────────────────────────────┤
│ ファイル選択: [ファイルを選択]  │
│ 最大50MBまで                    │
│                                 │
│ [キャンセル]  [アップロード]    │
└─────────────────────────────────┘
```

### 4. フォルダを開く

フォルダ名をクリックすると、そのフォルダ内のドキュメントが表示されます。

```
契約書 > 給食契約 > 2024年度
```

パンくずナビゲーションで階層を移動できます。

### 5. ファイルをダウンロード

ファイル名をクリックすると、ファイルがダウンロードされます。

### 6. 右クリックメニュー

ファイルやフォルダを右クリックすると、コンテキストメニューが表示されます。

```
┌─────────────────┐
│ 📂 開く         │
│ 📝 名前変更     │
│ 📥 ダウンロード │
│ 🔄 移動         │
│ ℹ️  プロパティ  │
│ ───────────────│
│ 🗑️  削除        │
└─────────────────┘
```

### 7. 検索

検索ボックスにキーワードを入力して、ファイルやフォルダを検索できます。

```
[🔍 ファイル・フォルダを検索...] [検索]
```

## 技術仕様

### フロントエンド
- **JavaScript**: ES6モジュール
- **UI**: Bootstrap 5モーダル
- **表示**: リスト/グリッド切替

### バックエンド
- **コントローラー**: `ContractDocumentController`
- **サービス**: `ContractDocumentService`
- **認可**: `ContractPolicy`

### データベース
- **テーブル**: `document_folders`, `document_files`
- **カテゴリ**: `contracts`

## セキュリティ

### 認可チェック
すべての操作でポリシーベースの認可チェックを実施します。

```php
$this->authorize('view', [FacilityContract::class, $facility]);
$this->authorize('update', [FacilityContract::class, $facility]);
```

### ファイルバリデーション
- ファイルサイズ: 最大50MB
- ファイルタイプ: 設定可能
- ファイル名: サニタイズ処理

### アクティビティログ
すべての操作をログに記録します。

## トラブルシューティング

### ドキュメントが表示されない

1. ブラウザコンソールを確認（F12キー）
2. ネットワークタブでAPIリクエストを確認
3. ユーザー権限を確認

### ファイルアップロードが失敗する

1. ファイルサイズを確認（最大50MB）
2. ストレージ権限を確認
   ```bash
   chmod -R 775 storage/app/public
   php artisan storage:link
   ```
3. ログを確認
   ```bash
   tail -f storage/logs/laravel.log
   ```

### モーダルが表示されない

1. Bootstrapが読み込まれているか確認
2. モーダルIDが重複していないか確認
3. z-indexを確認

## 検証

実装が正しく動作することを確認するには、検証スクリプトを実行します。

```bash
php scripts/verify-contract-document-implementation.php
```

すべての検証に合格すると、以下のメッセージが表示されます。

```
🎉 すべての検証に合格しました！
契約書のモーダルベースドキュメント管理システムは正しく実装されています。
```

## 関連ドキュメント

- [詳細実装サマリー](./contract-document-modal-implementation-summary.md)
- [ドキュメント管理システム概要](./README.md)
- [モーダル実装ガイドライン](../../.kiro/steering/modal-implementation-guide.md)
- [ファイルハンドリングガイドライン](../../.kiro/steering/file-handling.md)

## サポート

問題が発生した場合は、以下を確認してください：

1. **ブラウザコンソール**: エラーメッセージを確認
2. **ネットワークタブ**: APIリクエストとレスポンスを確認
3. **Laravelログ**: `storage/logs/laravel.log`を確認
4. **検証スクリプト**: 実装の整合性を確認

---

**最終更新**: 2025年10月16日  
**バージョン**: 1.0.0  
**ステータス**: ✅ 実装完了・検証済み
