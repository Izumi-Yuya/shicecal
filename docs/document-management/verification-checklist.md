# ドキュメントカテゴリ分離 - 検証チェックリスト

## クイックリファレンス

このチェックリストは、タスク 9.1（開発環境での動作確認）を実行する際の簡易版ガイドです。

## 事前準備

- [ ] 開発サーバーが起動している（`php artisan serve`）
- [ ] フロントエンドビルドが実行されている（`npm run dev`）
- [ ] テストユーザーでログイン済み
- [ ] テスト用施設が存在する

## 1. メインドキュメントタブ

### フォルダ作成
- [ ] 「ドキュメント」タブを開く
- [ ] 「新しいフォルダ」ボタンをクリック
- [ ] フォルダ名「メインドキュメントテスト」を入力
- [ ] フォルダが作成される
- [ ] フォルダがメインドキュメントタブに表示される

### データベース確認
```sql
SELECT id, name, category FROM document_folders 
WHERE name = 'メインドキュメントテスト';
-- category が NULL であることを確認
```

## 2. ライフライン設備

### 電気設備
- [ ] 「ライフライン設備」→「電気設備」タブを開く
- [ ] 「ドキュメント」セクションを展開
- [ ] 「新しいフォルダ」ボタンをクリック
- [ ] フォルダ名「電気設備テスト」を入力
- [ ] フォルダが作成される
- [ ] フォルダが電気設備セクションに表示される

```sql
SELECT id, name, category FROM document_folders 
WHERE name = '電気設備テスト';
-- category が 'lifeline_electrical' であることを確認
```

### その他の設備（同様の手順）
- [ ] ガス設備（`lifeline_gas`）
- [ ] 水道設備（`lifeline_water`）
- [ ] エレベーター設備（`lifeline_elevator`）
- [ ] 空調・照明設備（`lifeline_hvac_lighting`）

## 3. 修繕履歴

### 外装
- [ ] 「修繕履歴」→「外装」タブを開く
- [ ] 「ドキュメント」セクションを展開
- [ ] 「新しいフォルダ」ボタンをクリック
- [ ] フォルダ名「外装修繕テスト」を入力
- [ ] フォルダが作成される
- [ ] フォルダが外装セクションに表示される

```sql
SELECT id, name, category FROM document_folders 
WHERE name = '外装修繕テスト';
-- category が 'maintenance_exterior' であることを確認
```

### その他のカテゴリ（同様の手順）
- [ ] 内装（`maintenance_interior`）
- [ ] 夏季結露（`maintenance_summer_condensation`）
- [ ] その他（`maintenance_other`）

## 4. カテゴリ間独立性の確認

### メインドキュメントタブ
- [ ] メインドキュメントのフォルダのみ表示される
- [ ] ライフライン設備のフォルダは表示されない
- [ ] 修繕履歴のフォルダは表示されない

### ライフライン設備（各カテゴリ）
- [ ] 電気設備: 電気設備のフォルダのみ表示
- [ ] ガス設備: ガス設備のフォルダのみ表示
- [ ] 水道設備: 水道設備のフォルダのみ表示
- [ ] エレベーター設備: エレベーター設備のフォルダのみ表示
- [ ] 空調・照明設備: 空調・照明設備のフォルダのみ表示

### 修繕履歴（各カテゴリ）
- [ ] 外装: 外装のフォルダのみ表示
- [ ] 内装: 内装のフォルダのみ表示
- [ ] 夏季結露: 夏季結露のフォルダのみ表示
- [ ] その他: その他のフォルダのみ表示

## 5. 自動検証スクリプトの実行

```bash
# 施設IDを指定して検証スクリプトを実行
php scripts/verify-document-category-separation.php [施設ID]
```

### 期待される出力
- カテゴリ別のフォルダ・ファイル集計
- カテゴリ不一致の検出（なしであること）
- インデックスの使用確認
- 検証結果サマリー

## 6. パフォーマンス確認

### ブラウザでの体感確認
- [ ] フォルダ一覧の表示が1秒以内
- [ ] フォルダ作成が2秒以内
- [ ] ページ遷移がスムーズ

### データベースクエリ確認
```sql
-- インデックスが使用されていることを確認
EXPLAIN SELECT * FROM document_folders 
WHERE facility_id = [施設ID] AND category IS NULL;

EXPLAIN SELECT * FROM document_folders 
WHERE facility_id = [施設ID] AND category = 'lifeline_electrical';
```

## 7. エラーケースの確認

### ブラウザコンソール
- [ ] JavaScriptエラーがない
- [ ] ネットワークエラーがない
- [ ] APIレスポンスが正常

### Laravelログ
```bash
tail -f storage/logs/laravel.log
```
- [ ] エラーログがない
- [ ] 警告ログがない

## 検証完了の判定

### すべてチェックが完了したら
- [ ] すべてのカテゴリでフォルダ作成成功
- [ ] カテゴリ間の独立性が確認できた
- [ ] データベースで適切な category 値が設定されている
- [ ] パフォーマンスが要件を満たしている
- [ ] エラーがない

### 次のステップ
1. 検証結果を記録
2. 問題があれば修正
3. タスク 9.1 を完了としてマーク
4. タスク 9.2（パフォーマンステスト）に進む

## トラブルシューティング

### フォルダが作成できない
1. ブラウザコンソールでエラー確認
2. ネットワークタブでAPIレスポンス確認
3. Laravelログでサーバーエラー確認

### 他のカテゴリのフォルダが表示される
1. サービス層のスコープメソッド確認
2. データベースの category 値確認
3. キャッシュクリア（`php artisan cache:clear`）

### パフォーマンスが遅い
1. データベースのインデックス確認
2. クエリログで実行されているSQLを確認
3. N+1問題がないか確認

## 参考資料

- [詳細な検証ガイド](./category-separation-verification-guide.md)
- [トラブルシューティングガイド](./category-troubleshooting-guide.md)
- [実装ガイド](./category-implementation-guide.md)
