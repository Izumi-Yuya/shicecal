# 施設検索機能

Shise-Calの施設検索機能について説明します。

## 検索条件

### 1. サービスタイプ選択
- 利用可能なサービスタイプから選択
- 例：デイサービス、有料老人ホーム、ケアプラン、訪問看護、ヘルパー、グループホーム、本社

### 2. 都道府県選択
- 施設コードの最初の2桁から都道府県を判定
- 実際にデータが存在する都道府県のみ表示

### 3. キーワード検索
以下の項目を対象に部分一致検索：
- 施設名
- 会社名
- 事業所コード
- 住所

### 4. 表示順序
- 施設名の昇順で固定表示

## 検索結果表示

### 表示項目
- 事業所コード
- 施設名（詳細ページへのリンク）

### フィルター状況表示
- 検索結果件数
- 適用中のフィルター条件をバッジで表示

## 技術仕様

### 都道府県コードマッピング
施設コードの最初の2桁を都道府県コードとして使用：

```php
// config/prefectures.php
'codes' => [
    '01' => '北海道',
    '02' => '青森県',
    '03' => '岩手県',
    // ... 標準的な47都道府県
    '47' => '沖縄県',
]
```

**注意**: 標準的な都道府県コード（01-47）以外の施設は「未設定」として表示されます。

### データベースクエリ
- サービスタイプ：`facility_services`テーブルとのJOIN
- 都道府県：`office_code`の前方一致検索
- キーワード：複数フィールドのOR検索
- 表示順序：施設名の昇順で固定

### フロントエンド機能
- フィルター変更時の自動検索実行
- Enterキーでのキーワード検索
- 検索条件のクリア機能
- レスポンシブ対応

## 使用方法

### 基本的な検索
1. 施設一覧ページにアクセス
2. 検索条件を設定
3. 自動的に検索が実行される

### 複合検索
複数の条件を組み合わせて検索可能：
- サービスタイプ「デイサービス」+ 都道府県「千葉県」
- キーワード「ラ・ナシカ」+ サービスタイプ「有料老人ホーム」

### 検索結果の操作
- 施設名クリック：詳細ページへ移動

## パフォーマンス

### 最適化
- 必要なリレーションのみをEager Loading
- インデックスを活用した効率的なクエリ
- フロントエンドでの不要なリクエスト抑制

### 制限事項
- 現在はページネーションなし（全件表示）
- 大量データ時は将来的にページネーション実装予定

## 今後の拡張予定

1. **高度な検索機能**
   - 住所での地域検索
   - サービス更新期限での検索
   - 複数サービスタイプの同時選択

2. **検索結果の改善**
   - ページネーション
   - 検索結果のエクスポート
   - 保存された検索条件

3. **ユーザビリティ向上**
   - 検索履歴
   - お気に入り施設
   - 検索条件の保存・読み込み