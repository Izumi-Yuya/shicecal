# CSVエクスポート項目順序の修正

## 実施日時
2025-10-10

## 修正内容
CSVエクスポートの項目順序を変更し、建物情報が土地情報の直後に来るようにしました。

## 変更前の順序
1. 基本情報
2. 土地情報
3. ライフライン設備（電気、水道、ガス、エレベーター、空調・照明）
4. 防犯・防災設備（防犯カメラ、電子錠、消防、防災）
5. **建物情報** ← ここにあった
6. 図面
7. 修繕履歴
8. 契約書

## 変更後の順序
1. 基本情報
2. 土地情報
3. **建物情報** ← ここに移動
4. ライフライン設備（電気、水道、ガス、エレベーター、空調・照明）
5. 防犯・防災設備（防犯カメラ、電子錠、消防、防災）
6. 図面
7. 修繕履歴
8. 契約書

## 修正理由
- 土地情報と建物情報は密接に関連しているため、隣接して配置する方が論理的
- ユーザーが施設の基本的な物理情報（土地・建物）を先に確認できる
- ライフライン設備などの詳細情報はその後に配置

## 修正したファイル

### 1. app/Services/ExportService.php
`getAvailableFields()` メソッド内の項目定義順序を変更：
- 建物情報セクションを土地情報の直後に移動
- 元の位置（防災の後）から削除

### 2. config/csv-export-fields.php
配列の順序を変更：
- `'building'` キーを `'land'` の直後に移動
- 元の位置から削除

### 3. resources/views/export/csv/index.blade.php
- **変更なし**（既に正しい順序になっていた）

## 影響範囲

### CSVエクスポート
- CSV出力時の列の順序が変更される
- ヘッダー行の順序：基本情報 → 土地情報 → **建物情報** → ライフライン設備 → ...

### エクスポート画面
- 項目選択画面での表示順序が変更される
- カテゴリの並び順：基本情報 → 土地情報 → **建物情報** → 電気設備 → ...

### データの内容
- **変更なし**（順序のみの変更で、データ自体は変わらない）

## テスト方法

### 1. エクスポート画面の確認
```
http://localhost:8000/export/csv
```
1. 項目選択セクションを確認
2. 土地情報の次に建物情報が表示されることを確認

### 2. CSVエクスポートの実行
1. 施設を選択
2. 以下の項目を選択：
   - 基本情報の一部
   - 土地情報の一部
   - 建物情報の一部
   - ライフライン設備の一部
3. CSV出力を実行
4. ダウンロードしたCSVファイルを確認

### 3. 期待される結果
CSVヘッダーの順序：
```csv
会社名,施設名,...,土地所有区分,敷地面積（㎡数）,...,建物所有区分,建築面積（㎡数）,...,電力会社,...
```

## 互換性

### 既存のCSVファイル
- 既にエクスポートされたCSVファイルは影響を受けない
- 新しくエクスポートするCSVファイルのみ新しい順序になる

### インポート機能
- CSVインポート機能がある場合、列の順序に依存しないように実装されていることを確認する必要がある
- 列名（ヘッダー）で識別する実装であれば問題なし

## 関連ドキュメント
- `docs/csv-export-field-fix-implementation.md` - 項目差異修正
- `docs/csv-export-field-comparison.md` - 項目差異分析
- `config/csv-export-fields.php` - フィールド定義
- `app/Services/ExportService.php` - エクスポートサービス

## 今後の改善案

### 1. カテゴリのグループ化
現在の順序をさらに論理的にグループ化：
- **施設基本情報**: 基本情報、土地情報、建物情報
- **設備情報**: ライフライン設備、防犯・防災設備
- **管理情報**: 図面、修繕履歴、契約書

### 2. ユーザー設定可能な順序
- ユーザーが項目の順序をカスタマイズできる機能
- プリセット順序の保存機能

### 3. エクスポートテンプレート
- 用途別のエクスポートテンプレート（例：物件情報用、設備管理用など）
- テンプレートごとに最適な項目順序を設定
