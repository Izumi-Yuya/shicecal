# CSV出力画面 施設絞り込み検索機能

## 概要
CSV出力画面の施設選択時に、施設一覧画面と同じ絞り込み検索機能を追加しました。

## 実装内容

### 1. コントローラー修正 (ExportController.php)
- `csvIndex()` メソッドに部門と都道府県のデータ取得処理を追加
- 施設一覧画面と同じロジックで部門と都道府県を取得
- 「有料老人ホーム・グループホーム」の統合処理を実装

### 2. ビュー修正 (resources/views/export/csv/index.blade.php)
- 施設選択セクションに絞り込み検索UIを追加
  - 部門フィルター
  - 都道府県フィルター
  - キーワード検索（施設名、会社名、事業所コード、住所）
  - 検索クリアボタン
- 各施設アイテムにデータ属性を追加
  - `data-section`: 部門
  - `data-prefecture`: 都道府県
  - `data-facility-name`: 施設名
  - `data-company-name`: 会社名
  - `data-office-code`: 事業所コード
  - `data-address`: 住所
- 表示中の施設数カウンター追加

### 3. JavaScript修正 (resources/js/modules/export.js)
- `setupFacilityFilters()` メソッドを追加
  - 部門、都道府県、キーワードによるリアルタイムフィルタリング
  - 「有料老人ホーム・グループホーム」の統合フィルタリング対応
  - 表示中の施設数の更新
- `setupSelectAllButtons()` メソッドを修正
  - 全選択/全解除ボタンが表示中の施設のみを対象とするように変更

### 4. CSS修正 (resources/css/pages/export.css)
- フィルタリング時のスムーズな表示/非表示アニメーション追加

## 機能詳細

### 絞り込み条件
1. **部門フィルター**
   - すべての部門
   - 有料老人ホーム・グループホーム（統合）
   - デイサービスセンター
   - 訪問看護ステーション
   - ヘルパーステーション
   - ケアプランセンター
   - 他（事務所など）

2. **都道府県フィルター**
   - すべての都道府県
   - 施設が存在する都道府県のみ表示

3. **キーワード検索**
   - 施設名
   - 会社名
   - 事業所コード
   - 住所

### 動作仕様
- フィルター条件は即座に適用される（リアルタイム検索）
- 複数の条件を組み合わせて絞り込み可能（AND条件）
- 検索クリアボタンですべての条件をリセット
- 表示中の施設数と総施設数を表示
- 全選択/全解除ボタンは表示中の施設のみを対象

## テスト項目

### 基本動作
- [ ] 部門フィルターで正しく絞り込まれる
- [ ] 都道府県フィルターで正しく絞り込まれる
- [ ] キーワード検索で正しく絞り込まれる
- [ ] 複数条件の組み合わせで正しく絞り込まれる
- [ ] 検索クリアボタンですべての条件がリセットされる

### 特殊ケース
- [ ] 「有料老人ホーム・グループホーム」選択時に両方の部門が表示される
- [ ] 表示中の施設数が正しく更新される
- [ ] 全選択ボタンが表示中の施設のみを選択する
- [ ] 全解除ボタンが表示中の施設のみを解除する

### UI/UX
- [ ] フィルタリング時のアニメーションがスムーズ
- [ ] 検索結果が0件の場合も適切に表示される
- [ ] レスポンシブデザインが正しく動作する

## 施設一覧画面との整合性
- 部門の取得ロジックが完全に一致
- 都道府県の取得ロジックが完全に一致
- 「有料老人ホーム・グループホーム」の統合処理が一致
- キーワード検索の対象フィールドが一致

## 今後の拡張可能性
- お気に入り機能への絞り込み条件の保存
- 絞り込み条件のURL保存（ブックマーク対応）
- 高度な検索条件（日付範囲、定員数など）
- 検索履歴の保存

## 関連ファイル
- `app/Http/Controllers/ExportController.php`
- `resources/views/export/csv/index.blade.php`
- `resources/js/modules/export.js`
- `resources/css/pages/export.css`
- `config/prefectures.php`
