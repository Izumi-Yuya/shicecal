<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="test-token">
    <title>ApiClient Fix Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>ApiClient Fix Test</h1>
        
        <div class="alert alert-info">
            <h5>Test Results:</h5>
            <div id="test-results"></div>
        </div>
        
        <!-- ライフライン設備ドキュメント管理のテスト -->
        <div class="card">
            <div class="card-header">
                <h5>ライフライン設備ドキュメント管理テスト</h5>
            </div>
            <div class="card-body">
                <div data-lifeline-category="electrical" data-facility-id="1">
                    <p>電気設備ドキュメント管理コンテナ</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
        // テスト用のスクリプト
        const testResults = document.getElementById('test-results');
        
        function addResult(message, isError = false) {
            const div = document.createElement('div');
            div.className = isError ? 'text-danger' : 'text-success';
            div.textContent = message;
            testResults.appendChild(div);
        }
        
        try {
            // ApiClientのインポートテスト
            import('./public/build/js/app-unified-bf359c99.e47d7ed0.js').then(module => {
                addResult('✓ app-unified.js のインポートに成功');
                
                // ApiClientの確認
                if (window.ApiClient) {
                    addResult('✓ ApiClient が利用可能');
                    addResult('✓ ApiClient type: ' + typeof window.ApiClient);
                } else {
                    addResult('✗ ApiClient が利用できません', true);
                }
                
                // LifelineDocumentManagerの初期化テスト
                if (window.shiseCalApp) {
                    addResult('✓ ShiseCalApp が利用可能');
                    
                    // 初期化を試行
                    setTimeout(() => {
                        try {
                            window.shiseCalApp.initializeFacilityFeatures();
                            addResult('✓ Facility features の初期化に成功');
                        } catch (initError) {
                            addResult('✗ Facility features の初期化に失敗: ' + initError.message, true);
                        }
                    }, 1000);
                } else {
                    addResult('✗ ShiseCalApp が利用できません', true);
                }
            }).catch(error => {
                addResult('✗ app-unified.js のインポートに失敗: ' + error.message, true);
            });
            
        } catch (error) {
            addResult('✗ テスト実行エラー: ' + error.message, true);
        }
    </script>
</body>
</html>