<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Common Table - Responsive & Accessibility Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Include the common table styles */
        .facility-basic-info-table-clean {
            --bs-table-cell-padding-x: 0;
            --bs-table-cell-padding-y: 0;
            margin-bottom: 0 !important;
        }

        .card-body-clean {
            padding: 0 !important;
        }

        .facility-basic-info-table-clean td {
            padding: 0.5rem !important;
        }

        .detail-label {
            background-color: #495057 !important;
            color: white !important;
            font-weight: 600;
            text-align: center;
            vertical-align: middle;
            width: var(--detail-label-width, 150px);
            min-width: 120px;
            padding: 0.5rem !important;
        }

        .detail-value {
            background-color: #f8f9fa;
            color: #212529;
            vertical-align: middle;
            padding: 0.5rem !important;
        }

        .empty-field {
            color: #6c757d !important;
            font-style: italic;
            background-color: #f8f9fa !important;
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .facility-basic-info-table-clean td {
                padding: 0.4rem !important;
            }
            
            .detail-label {
                width: var(--detail-label-width-md, 120px);
                min-width: 100px;
                font-size: 0.9rem;
            }
            
            .detail-value {
                word-break: break-word;
                hyphens: auto;
            }
        }

        @media (max-width: 576px) {
            .facility-basic-info-table-clean td {
                padding: 0.3rem !important;
            }
            
            .detail-label {
                width: 100% !important;
                min-width: unset;
                text-align: left !important;
                font-size: 0.85rem;
                border-bottom: 1px solid #dee2e6;
                border-right: none;
            }
            
            .detail-value {
                width: 100% !important;
                text-align: left !important;
                font-size: 0.85rem;
                border-top: none;
            }
            
            .facility-basic-info-table-clean tr {
                display: block;
                margin-bottom: 0.5rem;
                border: 1px solid #dee2e6;
                border-radius: 0.375rem;
                overflow: hidden;
            }
            
            .facility-basic-info-table-clean td {
                display: block !important;
                width: 100% !important;
                border: none !important;
            }
        }

        /* High contrast mode */
        @media (prefers-contrast: high) {
            .detail-label {
                background-color: #000000 !important;
                color: #ffffff !important;
                border: 2px solid #ffffff !important;
            }
            
            .detail-value {
                background-color: #ffffff !important;
                color: #000000 !important;
                border: 2px solid #000000 !important;
            }
        }

        /* Focus styles */
        .detail-label:focus-visible,
        .detail-value:focus-visible {
            outline: 3px solid #0d6efd !important;
            outline-offset: 2px !important;
            box-shadow: 0 0 0 1px #ffffff, 0 0 0 4px #0d6efd !important;
        }

        /* Screen reader only */
        .sr-only {
            position: absolute !important;
            width: 1px !important;
            height: 1px !important;
            padding: 0 !important;
            margin: -1px !important;
            overflow: hidden !important;
            clip: rect(0, 0, 0, 0) !important;
            white-space: nowrap !important;
            border: 0 !important;
        }

        /* Test controls */
        .test-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            padding: 1rem;
            border: 1px solid #ccc;
            border-radius: 0.375rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .viewport-indicator {
            position: fixed;
            top: 10px;
            left: 10px;
            background: #007bff;
            color: white;
            padding: 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.8rem;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="viewport-indicator" id="viewportIndicator">
        Viewport: <span id="viewportSize"></span>
    </div>

    <div class="test-controls">
        <h6>Test Controls</h6>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="highContrast">
            <label class="form-check-label" for="highContrast">
                High Contrast Mode
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="noJs">
            <label class="form-check-label" for="noJs">
                No-JS Mode
            </label>
        </div>
        <button class="btn btn-sm btn-outline-primary mt-2" onclick="testKeyboardNavigation()">
            Test Keyboard Navigation
        </button>
    </div>

    <div class="container-fluid p-4">
        <h1>Common Table - Responsive & Accessibility Test</h1>
        <p>Resize your browser window to test responsive breakpoints at 768px and 576px.</p>

        <!-- Test Table 1: Basic Information -->
        <div class="facility-info-card detail-card-improved mb-3">
            <div class="card-header">
                <h5 class="card-title mb-0">基本情報</h5>
            </div>
            <div class="card-body card-body-clean">
                <div class="table-responsive table-responsive-md" role="region" aria-label="データテーブル">
                    <div class="sr-only">
                        基本情報の詳細情報テーブル。5行のデータが含まれています。
                    </div>
                    
                    <table class="table table-bordered facility-basic-info-table-clean" 
                           role="table" 
                           aria-label="基本情報の詳細情報" 
                           data-responsive="true" 
                           data-mobile-optimized="true">
                        <caption class="sr-only">基本情報の詳細情報</caption>
                        <tbody>
                            <tr class="standard-row" role="row" aria-label="会社名の情報行">
                                <td class="detail-label" scope="row" role="rowheader" aria-label="会社名" id="label-company">会社名</td>
                                <td class="detail-value" role="gridcell" aria-describedby="label-company" aria-label="株式会社テスト">株式会社テスト</td>
                            </tr>
                            <tr class="standard-row" role="row" aria-label="事業所コードの情報行">
                                <td class="detail-label" scope="row" role="rowheader" aria-label="事業所コード" id="label-code">事業所コード</td>
                                <td class="detail-value" role="gridcell" aria-describedby="label-code" aria-label="TEST001">TEST001</td>
                            </tr>
                            <tr class="standard-row" role="row" aria-label="住所の情報行">
                                <td class="detail-label" scope="row" role="rowheader" aria-label="住所" id="label-address">住所</td>
                                <td class="detail-value" role="gridcell" aria-describedby="label-address" aria-label="東京都渋谷区テスト1-2-3">東京都渋谷区テスト1-2-3</td>
                            </tr>
                            <tr class="standard-row" role="row" aria-label="電話番号の情報行">
                                <td class="detail-label" scope="row" role="rowheader" aria-label="電話番号" id="label-phone">電話番号</td>
                                <td class="detail-value empty-field" role="gridcell" aria-describedby="label-phone" aria-label="未設定の項目">未設定</td>
                            </tr>
                            <tr class="single-row" role="row" aria-label="単一項目行">
                                <td class="detail-value" role="gridcell" aria-label="備考: 長いテキストの例です。モバイルデバイスでの表示を確認するためのサンプルテキストです。" colspan="2">備考: 長いテキストの例です。モバイルデバイスでの表示を確認するためのサンプルテキストです。</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Test Table 2: Grouped Data -->
        <div class="facility-info-card detail-card-improved mb-3">
            <div class="card-header">
                <h5 class="card-title mb-0">グループ化データ</h5>
            </div>
            <div class="card-body card-body-clean">
                <div class="table-responsive table-responsive-md" role="region" aria-label="データテーブル">
                    <table class="table table-bordered facility-basic-info-table-clean" 
                           role="table" 
                           aria-label="グループ化データの詳細情報">
                        <tbody>
                            <tr class="grouped-row" role="row" aria-label="管理会社の情報行">
                                <td class="detail-label" scope="row" role="rowheader" rowspan="2">管理会社</td>
                                <td class="detail-value" role="gridcell">ABC管理株式会社</td>
                            </tr>
                            <tr class="standard-row" role="row">
                                <td class="detail-value" role="gridcell">03-1234-5678</td>
                            </tr>
                            <tr class="grouped-row" role="row" aria-label="オーナーの情報行">
                                <td class="detail-label" scope="row" role="rowheader" rowspan="2">オーナー</td>
                                <td class="detail-value" role="gridcell">田中太郎</td>
                            </tr>
                            <tr class="standard-row" role="row">
                                <td class="detail-value empty-field" role="gridcell" aria-label="未設定の項目">未設定</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Fallback Example -->
        <div class="facility-info-card detail-card-improved mb-3 no-js" role="alert" aria-live="polite">
            <div class="card-header">
                <h5 class="card-title mb-0">No-JS Fallback Example</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-warning d-flex align-items-center" role="alert">
                    <i class="fas fa-exclamation-triangle me-2" aria-hidden="true"></i>
                    <div>
                        <strong>表示エラー</strong><br>
                        JavaScriptが無効になっているか、データの読み込みに失敗しました。
                    </div>
                </div>
                
                <div class="text-center mt-3">
                    <button type="button" class="btn btn-outline-primary" onclick="location.reload()">
                        <i class="fas fa-redo me-1" aria-hidden="true"></i>
                        再読み込み
                    </button>
                </div>
                
                <div class="sr-only">
                    No-JS Fallback Exampleの情報表示。データの表示に問題が発生しました。
                </div>
            </div>
        </div>
    </div>

    <script>
        // Viewport size indicator
        function updateViewportIndicator() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            document.getElementById('viewportSize').textContent = `${width}x${height}px`;
            
            // Add breakpoint indicators
            let breakpoint = 'XL';
            if (width <= 576) breakpoint = 'XS';
            else if (width <= 768) breakpoint = 'SM';
            else if (width <= 992) breakpoint = 'MD';
            else if (width <= 1200) breakpoint = 'LG';
            
            document.getElementById('viewportIndicator').innerHTML = 
                `Viewport: <span id="viewportSize">${width}x${height}px (${breakpoint})</span>`;
        }

        // High contrast mode toggle
        document.getElementById('highContrast').addEventListener('change', function() {
            if (this.checked) {
                document.body.style.filter = 'contrast(150%) brightness(120%)';
            } else {
                document.body.style.filter = '';
            }
        });

        // No-JS mode toggle
        document.getElementById('noJs').addEventListener('change', function() {
            if (this.checked) {
                document.body.classList.add('no-js');
            } else {
                document.body.classList.remove('no-js');
            }
        });

        // Keyboard navigation test
        function testKeyboardNavigation() {
            const focusableElements = document.querySelectorAll('td[tabindex], td:focus, button, input');
            if (focusableElements.length > 0) {
                focusableElements[0].focus();
                alert('キーボードナビゲーションテスト開始。Tabキーで要素間を移動してください。');
            }
        }

        // Make table cells focusable for keyboard navigation test
        document.querySelectorAll('.detail-label, .detail-value').forEach(cell => {
            cell.setAttribute('tabindex', '0');
        });

        // Initialize
        updateViewportIndicator();
        window.addEventListener('resize', updateViewportIndicator);

        // Accessibility announcements
        function announceToScreenReader(message) {
            const announcement = document.createElement('div');
            announcement.setAttribute('aria-live', 'polite');
            announcement.setAttribute('aria-atomic', 'true');
            announcement.className = 'sr-only';
            announcement.textContent = message;
            document.body.appendChild(announcement);
            
            setTimeout(() => {
                document.body.removeChild(announcement);
            }, 1000);
        }

        // Test screen reader announcements
        setTimeout(() => {
            announceToScreenReader('レスポンシブテーブルのテストページが読み込まれました。');
        }, 1000);
    </script>
</body>
</html>