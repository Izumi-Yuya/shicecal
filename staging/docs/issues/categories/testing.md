# テスト関連の問題管理

テストに関する問題を管理します。

## 現在の問題

### High 優先度

#### ISSUE-2025-09-08-002: テスト分離の問題
- **ステータス**: Open
- **発見日**: 2025-09-08
- **概要**: NotificationServiceTest でテスト間のデータ分離ができておらず、テストが不安定
- **詳細**: 
  - `test_notify_comment_posted` と `test_notify_comment_posted_no_primary_responder` の間でデータが共有される
  - RefreshDatabase トレイトを使用しているが、テスト実行順序に依存してしまう
- **影響**: CI/CDでのテスト実行が不安定になる可能性
- **解決案**: 
  - モックを使用したテスト分離
  - データベーストランザクションの適切な使用
  - テスト実行順序に依存しない設計

### Low 優先度

#### ISSUE-2025-09-08-005: テストカバレッジの向上
- **ステータス**: Open
- **発見日**: 2025-09-08
- **概要**: 一部のテストがスキップされており、テストカバレッジが不十分
- **詳細**: 
  - FacilityComment モデルの status, assigned_to フィールド関連のテストがスキップ
  - 非アクティブユーザーのログインテストがスキップ
- **影響**: 品質保証の観点で改善の余地
- **解決案**: 
  - スキップされたテストの実装
  - 新機能のテストカバレッジ向上
  - テストメトリクスの導入

## 解決済みの問題

### ISSUE-2025-09-08-R001: FacilityTest でのモデル不整合
- **解決日**: 2025-09-08
- **問題**: Comment モデルと FacilityComment モデルの混在
- **解決方法**: モデル参照の統一

### ISSUE-2025-09-08-R002: LandInfoPolicyTest での department 未設定
- **解決日**: 2025-09-08
- **問題**: テストデータの不完全性
- **解決方法**: 必要なフィールドの設定

## テスト品質向上のための取り組み

### 現在の課題
1. **テスト分離**: データベース状態の分離が不十分
2. **テストデータ**: ファクトリーでの必須フィールド設定漏れ
3. **モック使用**: 外部依存の適切なモック化
4. **テスト実行時間**: 大量のテストによる実行時間の増加

### 改善計画
1. **テスト分離の改善**
   - データベーストランザクションの適切な使用
   - モックの積極的な活用
   - テスト実行順序に依存しない設計

2. **テストデータ管理**
   - ファクトリーの改善
   - テストデータの一貫性確保
   - シードデータの活用

3. **テストカバレッジ**
   - カバレッジレポートの導入
   - 未テスト機能の特定と対応
   - 継続的なカバレッジ監視

4. **テスト実行効率**
   - 並列実行の導入
   - 不要なテストの削除
   - テストグループ化による効率化

## テストベストプラクティス

### テスト作成時のチェックリスト
- [ ] 必要なテストデータが適切に設定されている
- [ ] 外部依存が適切にモック化されている
- [ ] テスト実行順序に依存していない
- [ ] エラーケースもテストされている
- [ ] テスト名が分かりやすい

### テスト実行時のチェックリスト
- [ ] 全テストが成功している
- [ ] テスト実行時間が適切な範囲内
- [ ] カバレッジが基準を満たしている
- [ ] 新機能のテストが追加されている