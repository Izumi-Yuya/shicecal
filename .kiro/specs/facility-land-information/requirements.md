# Requirements Document

## Introduction

施設詳細画面に土地情報管理機能を追加します。現在の基本情報タブに加えて、新たに「土地」タブを設け、土地の所有形態、面積、契約情報、管理会社・オーナー情報、関連書類の管理を可能にします。土地情報は施設基本情報と同様に、権限に応じた編集・閲覧制御と承認フローに対応します。

## Requirements

### Requirement 1

**User Story:** 編集者として、施設の土地情報を登録・編集したい、土地の詳細情報を一元管理するため

#### Acceptance Criteria

1. WHEN 編集者が施設詳細画面にアクセスする THEN システムは「基本」「土地」の2つのタブを表示する
2. WHEN 編集者が「土地」タブをクリックする THEN システムは土地情報の入力・表示フォームを表示する
3. WHEN 編集者が所有形態を選択する THEN システムは「自社」「賃借」「自社（賃貸）」のプルダウン選択肢を提供する
4. WHEN 編集者が敷地内駐車場台数を入力する THEN システムは半角数値（整数）10桁まで入力を受け付ける
5. WHEN 編集者が敷地面積（㎡）を入力する THEN システムは半角数字（小数点2桁まで）10桁まで入力を受け付ける
6. WHEN 編集者が敷地面積（坪数）を入力する THEN システムは半角数字（小数点2桁まで）10桁まで入力を受け付ける
7. WHEN 所有形態が「自社」の場合 AND 編集者が購入金額を入力する THEN システムは半角数字15桁まで入力を受け付け、表示時に3桁区切りカンマを付与する
8. WHEN 所有形態が「賃借」の場合 AND 編集者が家賃を入力する THEN システムは半角数字15桁まで入力を受け付け、表示時に3桁区切りカンマを付与する

### Requirement 2

**User Story:** システムとして、土地情報の自動計算を行いたい、データの整合性と利便性を向上させるため

#### Acceptance Criteria

1. WHEN 所有形態が「自社」 AND 購入金額と敷地面積（坪数）が入力されている THEN システムは坪単価を自動計算する（購入価格÷敷地面積（坪数））
2. WHEN 坪単価が計算される THEN システムは結果を3桁区切りカンマ付きで表示する
3. WHEN 所有形態が「賃借」 AND 契約開始日と契約終了日が入力されている THEN システムは契約年数を自動計算する
4. WHEN 契約年数が計算される THEN システムは「5年5ヶ月」形式で表示する
5. WHEN 敷地面積（㎡）が入力される THEN システムは表示時に「290.00㎡」形式で小数点2桁まで表示する
6. WHEN 敷地面積（坪数）が入力される THEN システムは表示時に「89.05坪」形式で小数点2桁まで表示する

### Requirement 3

**User Story:** 編集者として、賃借物件の契約情報を管理したい、契約期間と更新情報を把握するため

#### Acceptance Criteria

1. WHEN 所有形態が「賃借」の場合 AND 編集者が契約開始日を入力する THEN システムはYYYY/MM/DD形式（半角数字・記号）15桁まで入力を受け付ける
2. WHEN 所有形態が「賃借」の場合 AND 編集者が契約終了日を入力する THEN システムはYYYY/MM/DD形式（半角数字・記号）15桁まで入力を受け付ける
3. WHEN 契約日付が表示される THEN システムは内部データをYYYY/MM/DD形式で保存し、表示時は「2000年12月12日」の日本語形式に変換する
4. WHEN CSVエクスポート時 THEN システムは契約日付を計算に適したYYYY/MM/DD形式で出力する
5. WHEN 編集者が自動更新の有無を選択する THEN システムは「あり」「なし」のプルダウン選択肢を提供する

### Requirement 4

**User Story:** 編集者として、管理会社の情報を登録・管理したい、賃借物件の管理体制を把握するため

#### Acceptance Criteria

1. WHEN 所有形態が「賃借」の場合 AND 編集者が管理会社情報を入力する THEN システムは会社名（全角・半角30文字）の入力を受け付ける
2. WHEN 編集者が管理会社の郵便番号を入力する THEN システムはハイフンあり形式（半角数字＋ハイフン）8桁で入力を受け付ける
3. WHEN 編集者が管理会社の住所を入力する THEN システムは全角・半角・記号（-）30文字まで入力を受け付ける
4. WHEN 編集者が管理会社の住所建物名を入力する THEN システムは全角・半角・記号（-）20文字まで入力を受け付ける
5. WHEN 編集者が管理会社の電話番号を入力する THEN システムはハイフンあり形式（半角数字＋ハイフン）13桁で入力を受け付ける
6. WHEN 編集者が管理会社のFAX番号を入力する THEN システムはハイフンあり形式（半角数字＋ハイフン）13桁で入力を受け付ける
7. WHEN 編集者が管理会社のメールアドレスを入力する THEN システムはメール形式（半角）100文字まで入力を受け付ける
8. WHEN 編集者が管理会社のURLを入力する THEN システムはURL形式（半角）100文字まで入力を受け付ける
9. WHEN 編集者が管理会社の備考を入力する THEN システムはテキスト（複数行）1,000文字まで入力を受け付ける
10. IF 全角数字が入力される THEN システムは自動的に半角数字に変換する

### Requirement 5

**User Story:** 編集者として、オーナー情報を登録・管理したい、賃借物件のオーナーとの連絡体制を把握するため

#### Acceptance Criteria

1. WHEN 所有形態が「賃借」の場合 AND 編集者がオーナー情報を入力する THEN システムは氏名・会社名（全角・半角30文字）の入力を受け付ける
2. WHEN 編集者がオーナーの郵便番号を入力する THEN システムはハイフンあり形式（半角数字＋ハイフン）8桁で入力を受け付ける
3. WHEN 編集者がオーナーの住所を入力する THEN システムは全角・半角30文字まで入力を受け付ける
4. WHEN 編集者がオーナーの住所建物名を入力する THEN システムは全角・半角20文字まで入力を受け付ける
5. WHEN 編集者がオーナーの電話番号を入力する THEN システムはハイフンあり形式（半角数字＋ハイフン）13桁で入力を受け付ける
6. WHEN 編集者がオーナーのFAX番号を入力する THEN システムはハイフンあり形式（半角数字＋ハイフン）13桁で入力を受け付ける
7. WHEN 編集者がオーナーのメールアドレスを入力する THEN システムはメール形式（半角）100文字まで入力を受け付ける
8. WHEN 編集者がオーナーのURLを入力する THEN システムはURL形式（半角）100文字まで入力を受け付ける
9. WHEN 編集者がオーナーの備考欄を入力する THEN システムはテキスト（複数行）1,000文字まで入力を受け付ける

### Requirement 6

**User Story:** 編集者として、土地関連書類をアップロード・管理したい、重要書類を一元管理するため

#### Acceptance Criteria

1. WHEN 所有形態が「賃借」または「自社（賃貸）」の場合 AND 編集者が賃貸借契約書をアップロードする THEN システムはPDFファイルの複数アップロードを受け付ける
2. WHEN 編集者が謄本をアップロードする THEN システムはPDFファイルのアップロードを受け付ける
3. WHEN PDFファイルがアップロードされる THEN システムはファイルを施設の土地情報に紐づけて保存する
4. WHEN アップロードされたPDFを表示する THEN システムは権限に応じてファイルの閲覧・ダウンロードを許可する
5. WHEN PDFファイルが更新される THEN システムは古いファイルを履歴として保持し、最新版を表示する

### Requirement 7

**User Story:** 編集者として、土地情報の備考を記録したい、上記項目に該当しない土地情報を管理するため

#### Acceptance Criteria

1. WHEN 編集者が土地情報の備考欄を入力する THEN システムはテキスト（複数行）2,000文字まで入力を受け付ける
2. WHEN 備考欄に情報が入力される THEN システムは全角・半角・記号の入力を許可する
3. WHEN 備考欄が表示される THEN システムは改行を保持して表示する

### Requirement 8

**User Story:** 閲覧者として、権限に応じた土地情報を閲覧したい、必要な土地情報にアクセスするため

#### Acceptance Criteria

1. WHEN 閲覧者が施設詳細画面の「土地」タブにアクセスする THEN システムは権限に応じて土地情報を表示する
2. WHEN 閲覧者（役員・本社）がアクセスする THEN システムは全ての土地情報を表示する
3. WHEN 閲覧者（部門責任者）がアクセスする THEN システムは該当部門の施設の土地情報のみを表示する
4. WHEN 閲覧者（地区担当）がアクセする THEN システムは担当地区の施設の土地情報のみを表示する
5. WHEN 閲覧者（事業所）がアクセスする THEN システムは自施設の土地情報のみを表示する

### Requirement 9

**User Story:** システムとして、土地情報の承認フローを管理したい、情報の品質を保証するため

#### Acceptance Criteria

1. WHEN 承認機能がONの場合 AND 編集者が土地情報を編集する THEN システムは変更内容を承認待ち状態として保存し、承認者に通知を送信する
2. WHEN 承認機能がOFFの場合 AND 編集者が土地情報を編集する THEN システムは変更内容を即座に本番データに反映する
3. WHEN 承認者が土地情報の変更を確認する THEN システムは変更前後の土地情報を比較表示する
4. WHEN 承認者が土地情報の変更を承認する THEN システムは変更内容を本番データに反映し、編集者に完了通知を送信する
5. WHEN 承認者が土地情報の変更を差戻しする THEN システムはコメント入力を必須とし、編集者に差戻し理由を通知する

### Requirement 10

**User Story:** ユーザーとして、土地情報をCSV/PDF出力に含めたい、土地情報を含む施設情報を出力するため

#### Acceptance Criteria

1. WHEN ユーザーがCSV出力項目を選択する THEN システムは土地情報の各項目を選択可能な出力項目として表示する
2. WHEN ユーザーが土地情報を含むCSVを出力する THEN システムは選択された土地情報項目をCSVに含めて出力する
3. WHEN ユーザーが施設情報のPDFを出力する THEN システムは土地情報を含む帳票を生成する
4. WHEN 土地情報がPDF出力される THEN システムは所有形態に応じて関連項目のみを表示する（自社の場合は購入金額・坪単価、賃借の場合は家賃・契約情報等）