# 修繕履歴機能 要件定義書

## 概要

施設管理システムに修繕履歴タブを追加し、外装、内装リニューアル、その他の修繕履歴を管理する機能を実装する。防災・防犯タブの右隣に配置し、サブタブ形式で各カテゴリの修繕履歴を表示・編集できるようにする。

## 要件

### 要件1: メインタブの追加

**ユーザーストーリー:** 施設管理者として、防災・防犯タブの右隣に修繕履歴タブを追加したい。これにより、施設の修繕履歴を一元管理できるようになる。

#### 受入基準

1. WHEN 施設詳細画面を表示する THEN 防災・防犯タブの右隣に「修繕履歴」タブが表示される
2. WHEN 修繕履歴タブをクリックする THEN 修繕履歴のサブタブが表示される
3. WHEN 修繕履歴タブが選択されている THEN タブがアクティブ状態で表示される

### 要件2: サブタブナビゲーション

**ユーザーストーリー:** 施設管理者として、修繕履歴を外装、内装リニューアル、その他の3つのカテゴリに分けて管理したい。これにより、修繕内容を分類して効率的に確認できる。

#### 受入基準

1. WHEN 修繕履歴タブを選択する THEN 「外装」「内装リニューアル」「その他」の3つのサブタブが表示される
2. WHEN サブタブをクリックする THEN 対応するカテゴリの修繕履歴が表示される
3. WHEN 初回表示時 THEN 「外装」サブタブがデフォルトで選択される

### 要件3: 外装修繕履歴の表示

**ユーザーストーリー:** 施設管理者として、外装の修繕履歴を防水と塗装に分けて左右に表示したい。これにより、外装工事の種類別に履歴を確認できる。

#### 受入基準

1. WHEN 外装サブタブを選択する THEN 防水テーブルが左側、塗装テーブルが右側に表示される
2. WHEN 修繕履歴データが存在する THEN 施工日順（降順）でデータが表示される
3. WHEN データが多い場合 THEN テーブルがスクロール可能になる
4. WHEN 防水テーブルを表示する THEN 施工日、会社名、担当者、連絡先、備考の列が表示される
5. WHEN 塗装テーブルを表示する THEN 施工日、会社名、担当者、連絡先、備考の列が表示される
6. WHEN 防水保証期間情報が存在する THEN 保証期間テーブルが防水テーブルの下に表示される

### 要件4: 内装リニューアル修繕履歴の表示

**ユーザーストーリー:** 施設管理者として、内装リニューアルの修繕履歴を「内装リニューアル」と「内装・意匠履歴」の2つのセクションで表示したい。これにより、内装工事の詳細を確認できる。

#### 受入基準

1. WHEN 内装リニューアルサブタブを選択する THEN 「内装リニューアル」セクションが上部に表示される
2. WHEN 内装リニューアルセクションを表示する THEN リニューアル日、会社名、担当者、連絡先の情報が表示される
3. WHEN 内装・意匠履歴セクションを表示する THEN 施工日順（降順）でテーブル形式で履歴が表示される
4. WHEN 内装・意匠履歴テーブルを表示する THEN NO、施工日、施工会社、金額、区分、修繕内容、備考の列が表示される
5. WHEN データが多い場合 THEN テーブルがスクロール可能になる

### 要件5: その他修繕履歴の表示

**ユーザーストーリー:** 施設管理者として、外装・内装以外の修繕履歴を「改修工事履歴」として表示したい。これにより、すべての修繕工事を網羅的に管理できる。

#### 受入基準

1. WHEN その他サブタブを選択する THEN 「改修工事履歴」テーブルが表示される
2. WHEN 改修工事履歴テーブルを表示する THEN NO、施工日、施工会社、金額、区分、修繕内容、備考の列が表示される
3. WHEN 修繕履歴データが存在する THEN 施工日順（降順）でデータが表示される
4. WHEN データが多い場合 THEN テーブルがスクロール可能になる

### 要件6: データ表示の共通仕様

**ユーザーストーリー:** 施設管理者として、すべての修繕履歴テーブルで一貫した表示形式を使用したい。これにより、操作性と視認性を向上させる。

#### 受入基準

1. WHEN 修繕履歴テーブルを表示する THEN 行幅が固定される
2. WHEN データ量に応じて THEN 行数が動的に増加する
3. WHEN 行数が多い場合 THEN 縦スクロールで全データを確認できる
4. WHEN 施工日でソートする THEN 最新の施工日が上部に表示される（降順）
5. WHEN 金額データが存在する THEN 適切な数値フォーマットで表示される

### 要件7: 修繕履歴データの編集機能

**ユーザーストーリー:** 施設管理者として、修繕履歴データを追加・編集したい。これにより、最新の修繕情報を維持できる。

#### 受入基準

1. WHEN 編集権限を持つユーザーがアクセスする THEN 各サブタブに編集ボタンが表示される
2. WHEN 編集ボタンをクリックする THEN 対応するカテゴリの編集画面に遷移する
3. WHEN 編集画面を表示する THEN 現在のデータが入力フォームに表示される
4. WHEN データを保存する THEN バリデーションが実行される
5. WHEN 保存が成功する THEN 詳細画面にリダイレクトされ成功メッセージが表示される

### 要件8: 権限管理

**ユーザーストーリー:** システム管理者として、修繕履歴の閲覧・編集権限を既存の施設管理権限と統一したい。これにより、セキュリティを維持できる。

#### 受入基準

1. WHEN 閲覧権限を持つユーザーがアクセスする THEN 修繕履歴タブが表示される
2. WHEN 編集権限を持たないユーザーがアクセスする THEN 編集ボタンが表示されない
3. WHEN 権限のないユーザーが編集URLに直接アクセスする THEN 403エラーが表示される
4. WHEN 施設に対する権限がないユーザーがアクセスする THEN 修繕履歴が表示されない

### 要件9: 特記事項セクション

**ユーザーストーリー:** 施設管理者として、各カテゴリに特記事項を記録したい。これにより、重要な注意点や管理情報を共有できる。

#### 受入基準

1. WHEN 外装サブタブを表示する THEN 特記事項セクションが下部に表示される
2. WHEN 内装リニューアルサブタブを表示する THEN 特記事項セクションが下部に表示される
3. WHEN 特記事項が登録されている THEN テキストエリア形式で内容が表示される
4. WHEN 特記事項が未登録の場合 THEN 空のセクションが表示される

### 要件10: レスポンシブデザイン

**ユーザーストーリー:** 施設管理者として、様々なデバイスで修繕履歴を確認したい。これにより、現場でもオフィスでも同じように情報を確認できる。

#### 受入基準

1. WHEN モバイルデバイスでアクセスする THEN サブタブが適切に表示される
2. WHEN タブレットでアクセスする THEN 左右分割レイアウトが適切に調整される
3. WHEN 画面幅が狭い場合 THEN テーブルが横スクロール可能になる
4. WHEN タッチデバイスでアクセスする THEN タブの切り替えが正常に動作する