# 修繕履歴機能 実装タスクリスト

## 実装タスク

- [x] 1. データベース拡張とシーダー作成
  - 既存maintenance_historiesテーブルに不足カラムを追加するマイグレーションファイルを作成
  - 修繕履歴のテストデータを生成するシーダーファイルを作成
  - マイグレーションを実行してデータベーススキーマを更新
  - _要件: 1.1, 2.1, 3.1, 4.1, 5.1_

- [x] 2. MaintenanceHistoryモデルの拡張
  - MaintenanceHistoryモデルにカテゴリ・サブカテゴリの定数を追加
  - 新しいフィールドをfillableに追加し、適切なキャストを設定
  - カテゴリ・サブカテゴリ別のスコープメソッドを実装
  - 日付順ソート用のスコープメソッドを実装
  - _要件: 6.1, 6.4_

- [x] 3. RepairHistoryControllerの作成
  - RepairHistoryControllerクラスを作成
  - indexメソッドでカテゴリ別データ取得ロジックを実装
  - editメソッドで編集画面表示ロジックを実装
  - updateメソッドでデータ更新ロジックを実装
  - カテゴリ別バリデーションルールメソッドを実装
  - _要件: 7.1, 7.2, 7.4_

- [x] 4. ルート定義とポリシー実装
  - web.phpに修繕履歴関連のルートを追加
  - MaintenanceHistoryPolicyを作成または既存ポリシーを拡張
  - 閲覧・編集権限のチェックロジックを実装
  - _要件: 8.1, 8.2, 8.3_

- [x] 5. 修繕履歴ディレクトリとメインビューファイル作成
  - resources/views/facilities/repair-history/ディレクトリを作成
  - index.blade.phpでサブタブナビゲーション構造を実装
  - security-disasterパターンを参考にしたタブ切り替えJavaScriptを実装
  - 編集ボタンの権限チェック表示ロジックを実装
  - _要件: 1.1, 2.1, 2.2, 7.1_

- [x] 6. 外装タブのパーシャルビュー実装
  - partials/exterior-tab.blade.phpを作成
  - 防水テーブル（左側）と塗装テーブル（右側）の左右分割レイアウトを実装
  - 防水保証期間テーブルを防水テーブル下部に実装
  - 特記事項セクションを下部に実装
  - _要件: 3.1, 3.2, 3.6, 9.1_

- [x] 7. 内装リニューアルタブのパーシャルビュー実装
  - partials/interior-tab.blade.phpを作成
  - 内装リニューアル情報セクション（上部）を実装
  - 内装・意匠履歴テーブル（下部）を実装
  - 特記事項セクションを下部に実装
  - _要件: 4.1, 4.2, 4.3, 4.4, 9.2_

- [x] 8. その他タブのパーシャルビュー実装
  - partials/other-tab.blade.phpを作成
  - 改修工事履歴テーブルを実装
  - 施工日順ソート表示を実装
  - _要件: 5.1, 5.2, 5.3_

- [x] 9. 共通テーブルコンポーネントの実装
  - partials/repair-history-table.blade.phpを作成
  - NO、施工日、施工会社、金額、区分、修繕内容、備考の列構造を実装
  - 行幅固定、スクロール対応のCSSスタイルを実装
  - 金額の数値フォーマット表示を実装
  - _要件: 6.1, 6.2, 6.3, 6.5_

- [x] 10. 編集画面のビューファイル実装
  - edit.blade.phpを作成
  - カテゴリ別の編集フォーム構造を実装
  - 既存データの入力フォーム表示ロジックを実装
  - バリデーションエラー表示を実装
  - _要件: 7.2, 7.3, 7.4_

- [x] 11. 施設詳細画面への修繕履歴タブ統合
  - facilities/show.blade.phpに修繕履歴タブを追加
  - 防災・防犯タブの右隣に配置
  - タブクリック時の修繕履歴コンテンツ表示を実装
  - _要件: 1.1, 1.2, 1.3_

- [x] 12. CSS/JavaScriptの実装
  - 修繕履歴タブ用のCSSスタイルを実装
  - サブタブ切り替え用のJavaScriptを実装
  - レスポンシブデザイン対応のメディアクエリを実装
  - テーブルスクロール機能のスタイルを実装
  - _要件: 10.1, 10.2, 10.3, 10.4_

- [x] 13. バリデーション機能の実装
  - コントローラー内バリデーションを実装
  - 必須フィールド、日付形式、数値形式のバリデーションルールを実装
  - カスタムエラーメッセージを日本語で実装
  - _要件: 7.4_

- [x] 14. 単体テストの実装
  - MaintenanceHistoryモデルのテストケースを作成
  - RepairHistoryControllerのテストケースを作成
  - バリデーションルールのテストケースを作成
  - スコープメソッドのテストケースを作成

- [x] 15. 機能テストの実装
  - 修繕履歴表示機能のテストケースを作成
  - 編集機能のテストケースを作成
  - 権限チェック機能のテストケースを作成
  - タブ切り替え機能のテストケースを作成

- [x] 16. 統合テストとデバッグ
  - 施設詳細画面での修繕履歴タブ表示テストを実行
  - データの作成・更新の一連の流れをテスト
  - 複数ユーザーでの権限テストを実行
  - ブラウザ互換性テストを実行

- [ ] 17. ドキュメント更新
  - README.mdに修繕履歴機能の説明を追加
  - API仕様書に新しいエンドポイントを追加
  - ユーザーマニュアルに修繕履歴機能の使用方法を追加