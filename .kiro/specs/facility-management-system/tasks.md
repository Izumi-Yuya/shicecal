# Implementation Plan

- [ ] 1. プロジェクト基盤とコア機能の構築
  - Laravel 9.xプロジェクトの初期化とディレクトリ構造の設定
  - 基本的なMVCアーキテクチャの構築とルーティング設定
  - _Requirements: 1.1, 2.1_

- [x] 1.1 Laravel プロジェクトの初期化
  - Composer を使用してLaravel 9.x プロジェクトを作成
  - 基本的な設定ファイル（.env, config）の構成
  - Git リポジトリの初期化と初回コミット
  - ブランチ戦略の設定（main, develop, feature branches）
  - _Requirements: 1.1_

- [x] 1.2 データベース設計とマイグレーション作成
  - users, facilities, files, comments, maintenance_histories, export_favorites, system_settings, activity_logs テーブルのマイグレーション作成
  - 外部キー制約とインデックスの設定
  - マイグレーション実行とテスト
  - 変更内容をGitにコミット（feature/database-migrations）
  - リモートリポジトリへプッシュ
  - _Requirements: 1.2, 2.1, 8.1_

- [x] 1.3 Eloquent モデルの作成
  - User, Facility, File, Comment, MaintenanceHistory, ExportFavorite, SystemSetting, ActivityLog モデルの作成
  - リレーションシップの定義（hasMany, belongsTo）
  - モデルのスコープとアクセサの実装
  - モデル作成完了後にGitコミット（feature/eloquent-models）
  - リモートリポジトリへプッシュ
  - _Requirements: 1.2, 2.1_

- [x] 1.4 基本レイアウトの作成とテスト
  - Bootstrap 5の導入とCDN設定
  - 共通レイアウトファイル（app.blade.php）の作成
  - レイアウトの表示テスト実行
  - UI基盤完了後にGitコミット（feature/basic-layout）
  - リモートリポジトリへプッシュ
  - _Requirements: 全要件のUI部分_

- [x] 1.5 ナビゲーションメニューの実装とテスト
  - 基本的なナビゲーションバーの作成 ✅
  - メニュー項目の表示機能実装 ✅
  - ナビゲーション表示のテスト実行 ⚠️
  - **注意**: 認証システム実装後にテスト完了予定
  - **理由**: 現在のテストエラーは認証ミドルウェア関連
  - 実装完了後にGitコミット（feature/navigation-menu）
  - リモートリポジトリへプッシュ
  - _Requirements: 全要件のUI部分_

- [x] 1.6 施設一覧画面の基本実装とテスト
  - 施設一覧表示の基本画面作成
  - ダミーデータでの表示テスト
  - レスポンシブ表示のテスト実行
  - 実装完了後にGitコミット（feature/facility-list-basic）
  - リモートリポジトリへプッシュ
  - _Requirements: 2.1_

- [ ] 1.7 AWSテスト環境の初期構築とテスト
  - EC2 t2.micro インスタンスの作成と基本設定
  - SSH接続とセキュリティグループ設定
  - 接続テストと基本動作確認
  - _Requirements: 環境構築要件_

- [ ] 1.8 AWSテスト環境のWebサーバー構築とテスト
  - Apache/Nginx・PHP 8.1のインストール
  - Laravel プロジェクトのデプロイ準備
  - Webサーバー動作テストの実行
  - _Requirements: 環境構築要件_

- [ ] 1.9 AWSテスト環境のデータベース構築とテスト
  - MySQL 8.0のインストールと設定
  - データベース・ユーザーの作成
  - 接続テストとマイグレーション実行テスト
  - _Requirements: 環境構築要件_

- [x] 2. 認証システムの段階的実装
  - Laravel Sanctum を使用した認証システムの構築
  - テスト駆動でのログイン機能実装
  - 認証テストの作成と実行
  - _Requirements: 1.1, 12.1, 12.2, 12.3_

- [x] 2.1 Laravel Sanctum の導入とテスト
  - Laravel Sanctum のインストールと基本設定
  - 認証用マイグレーションの実行
  - Sanctum 動作テストの作成と実行
  - Sanctum導入完了後にGitコミット（feature/sanctum-setup）
  - リモートリポジトリへプッシュ
  - _Requirements: 12.1_

- [x] 2.2 ログイン機能の実装とテスト
  - ログインフォームの作成
  - ログイン処理の実装
  - ログイン機能のフィーチャーテスト作成と実行
  - 実装完了後にGitコミット（feature/login-functionality）
  - リモートリポジトリへプッシュ
  - _Requirements: 12.1_

- [x] 2.3 ログアウト機能の実装とテスト
  - ログアウト処理の実装
  - セッション管理の実装
  - ログアウト機能のテスト作成と実行
  - 実装完了後にGitコミット（feature/logout-functionality）
  - リモートリポジトリへプッシュ
  - _Requirements: 12.1_

- [x] 2.4 ユーザーロール定義とテスト
  - ユーザーロール（admin, editor, primary_responder, approver, viewer）の定義
  - ロール管理用のシーダー作成
  - ロール機能のユニットテスト作成と実行
  - 実装完了後にGitコミット（feature/user-roles）
  - リモートリポジトリへプッシュ
  - _Requirements: 1.3, 4.1, 4.2, 4.3, 4.4, 12.3_

- [x] 2.5 権限チェックミドルウェアの実装とテスト
  - 権限チェック用ミドルウェアの作成
  - ロール別アクセス制御の実装
  - ミドルウェアのテスト作成と実行
  - 実装完了後にGitコミット（feature/permission-middleware）
  - リモートリポジトリへプッシュ
  - _Requirements: 1.3, 4.1, 4.2, 4.3, 4.4, 12.3_

- [x] 2.6 IP制限機能の実装とテスト
  - IP制限チェック用ミドルウェアの作成
  - 許可IPアドレスの設定管理機能
  - IP制限機能のテスト作成と実行
  - 実装完了後にGitコミット（feature/ip-restriction）
  - リモートリポジトリへプッシュ
  - _Requirements: 12.2_

- [x] 3. ユーザー管理機能の実装
  - システム管理者用のユーザー管理画面の構築
  - ユーザーCRUD操作の実装
  - ロール・権限設定機能の実装
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7_

- [x] 3.1 ユーザー管理画面の作成
  - ユーザー一覧表示画面の実装
  - ユーザー検索・絞り込み機能の実装
  - ユーザー詳細表示画面の実装
  - 実装完了後にGitコミット（feature/user-management-ui）
  - リモートリポジトリへプッシュ
  - _Requirements: 1.1, 1.6_

- [x] 3.2 ユーザーCRUD操作の実装
  - 新規ユーザー登録機能の実装
  - ユーザー情報編集機能の実装
  - ユーザー削除機能の実装（論理削除）
  - 実装完了後にGitコミット（feature/user-crud）
  - リモートリポジトリへプッシュ
  - _Requirements: 1.2, 1.3, 1.5_

- [x] 3.3 権限範囲設定機能の実装
  - 地区担当・部門責任者の担当範囲設定機能
  - 閲覧権限範囲の管理機能
  - 権限変更の即座反映機能
  - 実装完了後にGitコミット（feature/permission-scope）
  - リモートリポジトリへプッシュ
  - _Requirements: 1.4_

- [x] 4. 施設管理機能の実装
  - 施設情報のCRUD操作機能の構築
  - 施設一覧・詳細表示機能の実装
  - 検索・絞り込み機能の実装
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7_

- [x] 4.1 施設一覧・検索機能の実装
  - 施設一覧表示画面の作成
  - 都道府県・施設名・事業所コードによる検索機能
  - ページネーション機能の実装
  - 実装完了後にGitコミット（feature/facility-list-search）
  - リモートリポジトリへプッシュ
  - _Requirements: 2.1, 2.7_

- [x] 4.2 施設詳細表示機能の実装
  - 施設詳細情報表示画面の作成
  - ロール別操作ボタンの表示制御
  - 承認済み情報の表示機能
  - 実装完了後にGitコミット（feature/facility-detail）
  - リモートリポジトリへプッシュ
  - _Requirements: 4.5_

- [x] 4.3 施設登録・編集機能の実装
  - 新規施設登録フォームの作成
  - 施設情報編集フォームの作成
  - バリデーション無しでの入力フィールド提供
  - 実装完了後にGitコミット（feature/facility-crud）
  - リモートリポジトリへプッシュ
  - _Requirements: 2.2, 2.3, 2.4_

- [x] 4.4 施設削除機能の実装
  - 施設削除機能の実装
  - 承認機能ON/OFF時の処理分岐
  - 削除確認ダイアログの実装
  - 実装完了後にGitコミット（feature/facility-delete）
  - リモートリポジトリへプッシュ
  - _Requirements: 2.5, 2.6_

- [x] 5. 承認機能の実装
  - 承認フローシステムの構築
  - 承認機能ON/OFF切り替え機能の実装
  - 承認待ち・差戻し機能の実装
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6_

- [x] 5.1 承認機能設定の実装
  - システム設定での承認機能ON/OFF切り替え
  - 承認機能状態の管理とチェック機能
  - 設定変更の即座反映機能
  - 実装完了後にGitコミット（feature/approval-settings）
  - リモートリポジトリへプッシュ
  - _Requirements: 3.6_

- [x] 5.2 承認フロー処理の実装
  - 承認待ち状態の管理機能
  - 承認者への通知機能
  - 承認・差戻し処理の実装
  - 実装完了後にGitコミット（feature/approval-flow）
  - リモートリポジトリへプッシュ
  - _Requirements: 3.1, 3.3, 3.4, 3.5_

- [x] 5.3 承認機能OFF時の処理実装
  - 即座反映処理の実装
  - 承認プロセススキップ機能
  - 処理分岐ロジックの実装
  - 実装完了後にGitコミット（feature/approval-bypass）
  - リモートリポジトリへプッシュ
  - _Requirements: 3.2_

- [x] 6. ファイル管理機能の実装
  - PDFファイルのアップロード・ダウンロード機能の構築
  - AWS S3との連携機能の実装
  - ファイルメタデータ管理機能の実装
  - _Requirements: 5.1, 5.2, 5.3, 5.4_

- [x] 6.1 ファイルアップロード機能の実装
  - PDFファイルアップロード機能の作成
  - AWS S3への保存機能の実装
  - ファイルメタデータの記録機能
  - 実装完了後にGitコミット（feature/file-upload）
  - リモートリポジトリへプッシュ
  - _Requirements: 5.1_

- [x] 6.2 ファイルダウンロード機能の実装
  - 権限チェック付きダウンロード機能
  - S3からのファイル取得機能
  - ファイル履歴管理機能
  - 実装完了後にGitコミット（feature/file-download）
  - リモートリポジトリへプッシュ
  - _Requirements: 5.2, 5.3_

- [x] 6.3 ファイルサイズ制限の実装
  - ファイルサイズチェック機能
  - 制限超過時のエラーハンドリング
  - エラーメッセージ表示機能
  - 実装完了後にGitコミット（feature/file-size-limit）
  - リモートリポジトリへプッシュ
  - _Requirements: 5.4_

- [x] 7. PDF出力機能の実装
  - 施設情報のPDF帳票出力機能の構築
  - 改ざん防止機能付きPDF生成
  - 一括出力機能の実装
  - _Requirements: 6.1, 6.2, 6.3_

- [x] 7.1 PDF帳票テンプレートの作成
  - 施設情報PDF帳票のレイアウト設計
  - Laravel DomPDFを使用したPDF生成機能
  - 承認済み情報のみ出力する制御機能
  - 実装完了後にGitコミット（feature/pdf-template）
  - リモートリポジトリへプッシュ
  - _Requirements: 6.1_

- [x] 7.2 改ざん防止機能の実装
  - PDFセキュリティ設定の実装
  - パスワード保護機能の実装
  - 印刷・編集制限の設定
  - 実装完了後にGitコミット（feature/pdf-security）
  - リモートリポジトリへプッシュ
  - _Requirements: 6.2_

- [x] 7.3 一括PDF出力機能の実装
  - 複数施設の一括PDF出力機能
  - ZIP形式での一括ダウンロード機能
  - 出力進捗表示機能
  - 実装完了後にGitコミット（feature/pdf-batch-export）
  - リモートリポジトリへプッシュ
  - _Requirements: 6.3_

- [x] 8. CSV出力機能の実装
  - 専用CSV出力メニューの構築
  - 施設選択・項目選択機能の実装
  - お気に入り設定管理機能の実装
  - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7_

- [x] 8.1 CSV出力メニューの作成
  - 専用CSV出力画面の実装
  - 権限に応じた施設一覧表示機能
  - 複数施設選択機能の実装
  - 実装完了後にGitコミット（feature/csv-export-menu）
  - リモートリポジトリへプッシュ
  - _Requirements: 7.1, 7.2_

- [x] 8.2 出力項目選択機能の実装
  - 利用可能項目一覧の表示機能
  - 任意項目選択機能の実装
  - 選択項目のプレビュー機能
  - 実装完了後にGitコミット（feature/csv-field-selection）
  - リモートリポジトリへプッシュ
  - _Requirements: 7.3_

- [x] 8.3 CSV生成・出力機能の実装
  - UTF-8+BOM形式でのCSV生成機能
  - 文字化け対策の実装
  - ダウンロード機能の実装
  - 実装完了後にGitコミット（feature/csv-generation）
  - リモートリポジトリへプッシュ
  - _Requirements: 7.4_

- [x] 8.4 お気に入り設定機能の実装
  - 出力条件の保存機能
  - お気に入り一覧表示機能
  - 削除・名称変更機能の実装
  - 実装完了後にGitコミット（feature/csv-favorites）
  - リモートリポジトリへプッシュ
  - _Requirements: 7.5, 7.6, 7.7_

- [x] 9. コメント・通知機能の実装
  - コメント投稿・管理機能の構築
  - 通知システムの実装
  - ステータス管理機能の実装
  - _Requirements: 8.1, 8.2, 8.3, 8.4_

- [x] 9.1 コメント投稿機能の実装
  - 施設情報へのコメント投稿機能
  - 項目別コメント紐付け機能
  - コメント保存機能の実装
  - 実装完了後にGitコミット（feature/comment-posting）
  - リモートリポジトリへプッシュ
  - _Requirements: 8.1_

- [x] 9.2 通知システムの実装
  - 一次対応者への自動通知機能
  - メール通知機能の実装（AWS SES）
  - 通知履歴管理機能
  - 実装完了後にGitコミット（feature/notification-system）
  - リモートリポジトリへプッシュ
  - _Requirements: 8.2_

- [x] 9.3 コメントステータス管理の実装
  - 未対応・対応中・対応済ステータス管理
  - ステータス更新機能の実装
  - 進捗可視化機能の実装
  - 実装完了後にGitコミット（feature/comment-status）
  - リモートリポジトリへプッシュ
  - _Requirements: 8.3_

- [x] 9.4 マイページ機能の実装
  - コメント投稿者用マイページ作成
  - 自身のコメント対応状況表示機能
  - 対応状況確認機能の実装
  - 実装完了後にGitコミット（feature/my-page）
  - リモートリポジトリへプッシュ
  - _Requirements: 8.4_

- [ ] 10. 修繕履歴管理機能の実装
  - 修繕履歴の登録・管理機能の構築
  - 履歴検索・表示機能の実装
  - 時系列表示機能の実装
  - _Requirements: 9.1, 9.2, 9.3_

- [-] 10.1 修繕履歴登録機能の実装
  - 修繕履歴登録フォームの作成
  - 修繕対応日・内容・費用・業者情報の記録機能
  - 履歴保存機能の実装
  - 実装完了後にGitコミット（feature/maintenance-registration）
  - リモートリポジトリへプッシュ
  - _Requirements: 9.1_

- [ ] 10.2 修繕履歴検索機能の実装
  - 施設別・期間別・修繕内容による検索機能
  - 検索結果表示機能の実装
  - 検索条件保存機能の実装
  - 実装完了後にGitコミット（feature/maintenance-search）
  - リモートリポジトリへプッシュ
  - _Requirements: 9.2_

- [ ] 10.3 修繕履歴表示機能の実装
  - 時系列順履歴一覧表示機能
  - 履歴詳細表示機能の実装
  - 履歴編集・削除機能の実装
  - 実装完了後にGitコミット（feature/maintenance-display）
  - リモートリポジトリへプッシュ
  - _Requirements: 9.3_

- [ ] 11. 年次情報確認機能の実装
  - 年次確認依頼・回答システムの構築
  - 確認ログ記録機能の実装
  - 監査証跡管理機能の実装
  - _Requirements: 10.1, 10.2, 10.3, 10.4_

- [ ] 11.1 年次確認依頼機能の実装
  - 施設責任者への確認依頼通知機能
  - 確認対象施設の選択機能
  - 依頼スケジュール管理機能
  - 実装完了後にGitコミット（feature/annual-confirmation-request）
  - リモートリポジトリへプッシュ
  - _Requirements: 10.1_

- [ ] 11.2 年次確認回答機能の実装
  - 施設責任者用確認画面の作成
  - 確認完了・相違報告選択機能
  - 回答結果記録機能の実装
  - 実装完了後にGitコミット（feature/annual-confirmation-response）
  - リモートリポジトリへプッシュ
  - _Requirements: 10.2_

- [ ] 11.3 相違報告処理機能の実装
  - 編集者への相違通知機能
  - 対応促進機能の実装
  - 対応状況追跡機能の実装
  - 実装完了後にGitコミット（feature/discrepancy-handling）
  - リモートリポジトリへプッシュ
  - _Requirements: 10.3_

- [ ] 11.4 確認ログ管理機能の実装
  - 年次確認ログの記録機能
  - 監査証跡保持機能の実装
  - ログ検索・出力機能の実装
  - 実装完了後にGitコミット（feature/confirmation-logs）
  - リモートリポジトリへプッシュ
  - _Requirements: 10.4_

- [ ] 12. ログ管理・監査機能の実装
  - 操作ログ記録システムの構築
  - ログ検索・表示機能の実装
  - ログエクスポート機能の実装
  - _Requirements: 11.1, 11.2, 11.3_

- [ ] 12.1 操作ログ記録機能の実装
  - 全ユーザー操作の自動ログ記録機能
  - 操作種別・対象・時刻の記録機能
  - IPアドレス・ユーザーエージェント記録機能
  - 実装完了後にGitコミット（feature/activity-logging）
  - リモートリポジトリへプッシュ
  - _Requirements: 11.1_

- [ ] 12.2 ログ検索・表示機能の実装
  - ユーザー・操作種別・期間による検索機能
  - ログ一覧表示機能の実装
  - ログ詳細表示機能の実装
  - 実装完了後にGitコミット（feature/log-search-display）
  - リモートリポジトリへプッシュ
  - _Requirements: 11.2_

- [ ] 12.3 ログエクスポート機能の実装
  - CSV形式でのログデータ出力機能
  - 期間指定エクスポート機能
  - 監査用レポート生成機能
  - 実装完了後にGitコミット（feature/log-export）
  - リモートリポジトリへプッシュ
  - _Requirements: 11.3_

- [ ] 13. 詳細フロントエンド UI/UX の実装
  - 高度なユーザビリティを考慮したインターフェース設計
  - ロール別画面表示制御の実装
  - JavaScript機能の追加実装
  - _Requirements: 全要件のUI部分_

- [ ] 13.1 管理者画面のUI実装
  - ユーザー管理画面のUI作成
  - システム設定画面のUI実装
  - ログ管理画面のUI作成
  - 実装完了後にGitコミット（feature/admin-ui）
  - リモートリポジトリへプッシュ
  - _Requirements: 1.1, 1.6, 11.2_

- [ ] 13.2 出力機能画面のUI実装
  - CSV出力画面のUI作成
  - PDF出力画面のUI実装
  - お気に入り管理画面のUI作成
  - 実装完了後にGitコミット（feature/export-ui）
  - リモートリポジトリへプッシュ
  - _Requirements: 7.1, 7.2, 8.1, 8.4_

- [ ] 13.3 コメント・通知機能のUI実装
  - コメント投稿・表示画面のUI作成
  - 通知一覧・マイページのUI実装
  - ステータス管理画面のUI作成
  - 実装完了後にGitコミット（feature/comment-notification-ui）
  - リモートリポジトリへプッシュ
  - _Requirements: 8.1, 8.2, 8.3, 8.4_

- [ ] 14. テスト実装とデバッグ
  - ユニットテスト・フィーチャーテストの作成
  - テストデータ・シーダーの実装
  - バグ修正・パフォーマンス最適化
  - _Requirements: 全要件のテスト部分_

- [ ] 14.1 ユニットテストの実装
  - モデル・サービスクラスのユニットテスト作成
  - ビジネスロジックのテストケース実装
  - テストカバレッジ80%以上の達成
  - 実装完了後にGitコミット（feature/unit-tests）
  - リモートリポジトリへプッシュ
  - _Requirements: 全要件のロジック部分_

- [ ] 14.2 フィーチャーテストの実装
  - API エンドポイントのフィーチャーテスト作成
  - 認証・認可機能のテスト実装
  - ファイル操作機能のテスト実装
  - 実装完了後にGitコミット（feature/feature-tests）
  - リモートリポジトリへプッシュ
  - _Requirements: 全要件の機能部分_

- [ ] 14.3 テストデータ・シーダーの作成
  - 各ロールのテストユーザー作成
  - サンプル施設データの作成
  - システム設定デフォルト値の設定
  - 実装完了後にGitコミット（feature/test-data-seeders）
  - リモートリポジトリへプッシュ
  - _Requirements: 全要件のデータ部分_

- [ ] 15. デプロイメント・環境構築
  - ローカル・テスト・本番環境の構築
  - CI/CDパイプラインの設定
  - 本番リリース準備
  - _Requirements: 環境構築要件_

- [ ] 15.1 テスト環境デプロイとテスト
  - AWSテスト環境への初回デプロイ実行
  - 基本機能の動作確認とテスト
  - 環境固有の設定調整と最適化
  - _Requirements: 環境構築要件_

- [ ] 15.2 ローカル開発環境の詳細構築
  - Docker Compose を使用した開発環境構築
  - 開発用データベース・ファイルストレージ設定
  - 開発者向けセットアップドキュメント作成
  - 実装完了後にGitコミット（feature/local-dev-environment）
  - リモートリポジトリへプッシュ
  - _Requirements: 環境構築要件_

- [ ] 15.3 AWS本番環境の構築
  - 本番用EC2・RDS・S3・CloudFrontの設定
  - SSL証明書・ドメイン設定
  - バックアップ・監視設定の実装
  - _Requirements: 環境構築要件_

- [ ] 15.4 CI/CDパイプラインの構築
  - GitHub Actions を使用した自動テスト・デプロイ設定
  - テスト・本番環境への自動デプロイ機能
  - デプロイ後の動作確認自動化
  - _Requirements: 環境構築要件_
## 
Git ワークフロー指針

### ブランチ戦略
- **main**: 本番リリース用ブランチ
- **develop**: 開発統合ブランチ
- **feature/**: 機能開発用ブランチ（例: feature/user-management）
- **hotfix/**: 緊急修正用ブランチ

### コミット指針
- **頻度**: 各サブタスク完了時に必ずコミット
- **メッセージ**: 「[タスク番号] 機能名: 実装内容」形式
- **例**: 「[1.2] Database: Create users and facilities migrations」

### プルリクエスト
- feature ブランチから develop へのマージ時
- develop から main へのマージ時（リリース前）
- コードレビューとテスト実行を必須とする

### タグ付け
- 各マイルストーン完了時にバージョンタグを作成
- 例: v0.1.0（基盤完成）、v0.2.0（認証完成）、v1.0.0（初回リリース）