# Requirements Document

## Introduction

Shise-Cal（施設カルテシステム）は、現在紙やExcelで個別管理されている施設情報を一元管理し、権限と承認機能によって業務効率と情報の整合性を向上させるWebアプリケーションです。本システムは、施設基本情報の登録・更新、契約・建物情報の管理、PDF/CSV出力、閲覧・通知・承認フロー、修繕履歴管理、年次情報確認機能を提供します。

## Requirements

### Requirement 1

**User Story:** システム管理者として、ユーザーの登録・削除・ロール設定・権限管理を行いたい、システム全体を適切に管理するため

#### Acceptance Criteria

1. WHEN システム管理者がユーザー管理画面にアクセスする THEN システムは全ユーザーの一覧をロール・最終ログイン日・ステータスと共に表示する
2. WHEN システム管理者が新規ユーザーを登録する THEN システムはメールアドレス・パスワード・ロール・閲覧権限範囲の入力フィールドを提供する（入力チェックは実施しない）
3. WHEN システム管理者がユーザーのロールを変更する THEN システムは変更を即座に反映し、該当ユーザーの権限を更新する
4. WHEN システム管理者がユーザーの閲覧権限を設定する THEN システムは地区担当・部門責任者の場合に担当範囲を指定できる
5. WHEN システム管理者がユーザーを削除する THEN システムは確認ダイアログを表示し、削除後は該当ユーザーのアクセスを無効化する
6. WHEN システム管理者がユーザーを検索する THEN システムはメールアドレス・ロール・ステータスによる絞り込み機能を提供する
7. WHEN システム管理者がログ管理を行う THEN システムは全ユーザーの操作履歴を確認できる

### Requirement 2

**User Story:** 編集者として、施設情報の登録・編集・削除を行いたい、施設情報を最新の状態に保つため

#### Acceptance Criteria

1. WHEN 編集者が施設一覧画面にアクセスする THEN システムは全施設の一覧を都道府県名・事業所コード・施設名・最終更新日で表示する
2. WHEN 編集者が新規施設を登録する THEN システムは会社名・事業所コード・指定番号・施設名・郵便番号・住所・電話番号の入力フィールドを提供する（バリデーションは実施しない）
3. WHEN 承認機能がONの場合 AND 編集者が施設情報を編集する THEN システムは変更内容を承認待ち状態として保存し、承認者に通知を送信する
4. WHEN 承認機能がOFFの場合 AND 編集者が施設情報を編集する THEN システムは変更内容を即座に本番データに反映する
5. WHEN 承認機能がONの場合 AND 編集者が施設を削除する THEN システムは削除申請を承認者に送信し、承認後に削除を実行する
6. WHEN 承認機能がOFFの場合 AND 編集者が施設を削除する THEN システムは確認ダイアログ後に即座に削除を実行する
7. WHEN 編集者が施設情報を検索する THEN システムは都道府県・施設名・事業所コードによる絞り込み検索を提供する

### Requirement 3

**User Story:** 承認者として、編集された内容を確認・承認・差戻しを行いたい、情報の品質を保証するため

#### Acceptance Criteria

1. WHEN 承認機能がONの場合 AND 承認者に承認依頼が届く THEN システムは承認待ち一覧画面に該当項目を表示し、メール通知を送信する
2. WHEN 承認機能がOFFの場合 AND 編集者が情報を更新する THEN システムは承認プロセスをスキップして即座に本番データに反映する
3. WHEN 承認者が承認待ち項目を確認する THEN システムは変更前後の内容を比較表示する
4. WHEN 承認者が承認する THEN システムは変更内容を本番データに反映し、編集者に完了通知を送信する
5. WHEN 承認者が差戻しする THEN システムはコメント入力を必須とし、編集者に差戻し理由を通知する
6. WHEN システム管理者が承認機能設定を変更する THEN システムは承認機能のON/OFF状態を即座に反映する

### Requirement 4

**User Story:** 閲覧者として、権限に応じた施設情報を閲覧したい、必要な情報にアクセスするため

#### Acceptance Criteria

1. WHEN 閲覧者（役員・本社）がアクセスする THEN システムは全施設の情報を表示する
2. WHEN 閲覧者（部門責任者）がアクセスする THEN システムは該当部門の施設のみを表示する
3. WHEN 閲覧者（地区担当）がアクセスする THEN システムは担当地区の施設のみを表示する
4. WHEN 閲覧者（事業所）がアクセスする THEN システムは自施設の情報のみを表示する
5. WHEN 閲覧者が施設詳細を確認する THEN システムは承認済みの最新情報を表示する

### Requirement 5

**User Story:** ユーザーとして、PDFファイルをアップロード・ダウンロードしたい、重要書類を一元管理するため

#### Acceptance Criteria

1. WHEN 編集者がPDFファイルをアップロードする THEN システムは契約書・図面などのファイルを施設単位で保存する
2. WHEN 閲覧者がPDFをダウンロードする THEN システムは閲覧権限を確認してファイルを提供する
3. WHEN PDFファイルが更新される THEN システムは古いファイルを履歴として保持し、最新版を表示する
4. IF PDFファイルのサイズが制限を超える THEN システムはエラーメッセージを表示し、アップロードを拒否する

### Requirement 6

**User Story:** ユーザーとして、施設情報をPDF形式で出力したい、提出資料や報告書を作成するため

#### Acceptance Criteria

1. WHEN ユーザーがPDF出力を実行する THEN システムは承認済み情報のみを帳票形式で出力する
2. WHEN PDF出力が完了する THEN システムは改ざん防止のためのセキュリティ設定を適用する
3. WHEN 複数施設のPDF出力を実行する THEN システムは一括出力機能を提供する

### Requirement 7

**User Story:** ユーザーとして、施設情報をCSV形式で出力したい、業務報告・集計作業を効率化するため

#### Acceptance Criteria

1. WHEN ユーザーがCSV出力メニューにアクセスする THEN システムは専用のCSV出力画面を表示する
2. WHEN ユーザーが施設を選択する THEN システムは権限に応じた施設一覧から複数選択を可能にする
3. WHEN ユーザーが出力項目を選択する THEN システムは利用可能な項目一覧から任意の項目を選択可能にする
4. WHEN CSV出力が完了する THEN システムはUTF-8+BOM形式で文字化け対策を施したファイルを提供する
5. WHEN ユーザーが出力条件を保存する THEN システムは「お気に入り」として施設と項目の組み合わせを保存する
6. WHEN ユーザーがお気に入りを管理する THEN システムは削除・名称変更機能を提供する
7. WHEN ユーザーがお気に入りを呼び出す THEN システムは保存済みの施設選択と項目選択を自動設定する

### Requirement 8

**User Story:** 閲覧者として、施設情報にコメントを投稿したい、確認内容や修正依頼を記録・共有するため

#### Acceptance Criteria

1. WHEN 閲覧者がコメントを投稿する THEN システムは対象施設情報や項目に紐づけてコメントを保存する
2. WHEN コメントが投稿される THEN システムは編集者の一次対応者に自動通知を送信する
3. WHEN 一次対応者がコメントを確認する THEN システムは「未対応」「対応中」「対応済」のステータス管理機能を提供する
4. WHEN コメント投稿者が対応状況を確認する THEN システムはマイページで自身のコメントの対応状況を表示する

### Requirement 9

**User Story:** 編集者として、修繕履歴を記録・管理したい、修繕の履歴を蓄積し次回対応に備えるため

#### Acceptance Criteria

1. WHEN 編集者が修繕履歴を登録する THEN システムは修繕対応日・内容・費用・業者情報を記録する
2. WHEN 修繕履歴を検索する THEN システムは施設別・期間別・修繕内容による検索機能を提供する
3. WHEN 修繕履歴を表示する THEN システムは時系列順に履歴を一覧表示する

### Requirement 10

**User Story:** システム管理者として、年次情報確認機能を実行したい、情報の整合性確認と監査証跡を確保するため

#### Acceptance Criteria

1. WHEN 年次確認が開始される THEN システムは施設責任者に確認依頼通知を送信する
2. WHEN 施設責任者が情報を確認する THEN システムは確認完了または相違報告の選択肢を提供する
3. WHEN 相違が報告される THEN システムは編集者に通知を送信し、対応を促す
4. WHEN 年次確認が完了する THEN システムは確認ログを記録し、監査証跡として保持する

### Requirement 11

**User Story:** システム管理者として、操作ログを確認したい、操作履歴の可視化・監査対応を行うため

#### Acceptance Criteria

1. WHEN システム管理者がログ画面にアクセスする THEN システムは誰が・いつ・何を操作したかの履歴を表示する
2. WHEN ログを検索する THEN システムはユーザー・操作種別・期間による絞り込み機能を提供する
3. WHEN ログをエクスポートする THEN システムはCSV形式でログデータを出力する

### Requirement 12

**User Story:** ユーザーとして、セキュアな環境でシステムを利用したい、情報漏洩リスクを最小化するため

#### Acceptance Criteria

1. WHEN ユーザーがログインする THEN システムはメールアドレス・パスワードによる認証を要求する
2. WHEN 社外IPからアクセスする THEN システムはアクセスを拒否し、エラーメッセージを表示する
3. WHEN ユーザーがデータにアクセスする THEN システムはロールに基づいて機能を制限する
4. WHEN お気に入り設定にアクセスする THEN システムは登録ユーザー本人のみに閲覧を許可する